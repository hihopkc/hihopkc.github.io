<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>渗透测试内网环境分析 | 嘻哈磕碜のBlogs</title><meta name="author" content="hihopkc"><meta name="copyright" content="hihopkc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="渗透测试内网环境分析"><meta name="application-name" content="渗透测试内网环境分析"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="渗透测试内网环境分析"><meta property="og:url" content="https://hihopkc.github.io/posts/26b5.html"><meta property="og:site_name" content="嘻哈磕碜のBlogs"><meta property="og:description" content="什么是内网渗透在拿到webshell&amp;#x2F;meterpreter&amp;#x2F;beacon的时候，想办法获得系统信息拿到系统权限，进入到网络系统内部之 后收集内部网络的各种信息，获取内部网络有价值的人员、资产信息。 内网渗透的第一步，内网信息收集 内网外网简介内网外网概念内网  内网又称局域网（"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://hihopkc.github.io/img/default_cover.jpg"><meta property="article:author" content="hihopkc"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://hihopkc.github.io/img/default_cover.jpg"><meta name="description" content="什么是内网渗透在拿到webshell&amp;#x2F;meterpreter&amp;#x2F;beacon的时候，想办法获得系统信息拿到系统权限，进入到网络系统内部之 后收集内部网络的各种信息，获取内部网络有价值的人员、资产信息。 内网渗透的第一步，内网信息收集 内网外网简介内网外网概念内网  内网又称局域网（"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://hihopkc.github.io/posts/26b5"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"tianli","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"00af80c1b4c617346c21","Referer":"https://hihopkc.github.io/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://hihopkc.space/',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://www.hihopkc.site/"},
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":null},
  algolia: {"appId":"R27EJ0K44Q","apiKey":"2631264c2276b5498f37a67d587bc878","indexName":"Demo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: hihopkc","link":"链接: ","source":"来源: 嘻哈磕碜のBlogs","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '嘻哈磕碜のBlogs',
  title: '渗透测试内网环境分析',
  postAI: 'true',
  pageFillDescription: '什么是内网渗透, 内网外网简介, 内网外网概念, 公网IP与私网IP地址, NAT网络地址转换, Windows工作组, 工作组简介, 工作组的加入和退出, Windows域环境, 域简介, 域网络的功能和特点, 工作组和域的区别, 域控DC, 活动目录, 简介, 主要功能, NTDS.dit, 逻辑结构, AD域服务, DNS域名服务器, 域信任关系, 域结构分类, 单域, 父子域, 域树, 域林, 域的原理, 安全域的划分, 域中计算机的分类, 域内权限, A-G-DL-P策略, 域内权限解读, 内网域渗透, 域渗透思路, 机器位置判断, 机器角色判断, 连通性判断, 协议的判断, 端口判断, 代理服务器什么是内网渗透在拿到的时候想办法获得系统信息拿到系统权限进入到网络系统内部之后收集内部网络的各种信息获取内部网络有价值的人员资产信息内网渗透的第一步内网信息收集内网外网简介内网外网概念内网内网又称局域网是指在某一区域内由多台计算机以及网络设备构成的网络比如校园网政府网等一般方圆几公里我们常说的内网从字面意思上来讲是区别于外网的也就是说内网一般是用于局域网内部的计算机之间的互相通信如果需要访问需要借助外网外网外网也被称为广域网是连接不同地区局域网或城域网计算机通信的远程网所覆盖的范围从几十公里到几千公里它能连接多个地区城市和国家或横跨几个洲并能提供远距离通信形成国际性的远程网络广域网并不等同于互联网内网与外网区别内网和外网的覆盖范围不一样内网通常是一个学校一个医院的网络外网通常指网内网一般是用于局域网内部的计算机之间的互相通信如果需要访问需要借助外网一般可以使用技术实现内网访问外网内网的地址一般使用私有地址例如外网需要使用公网地址公网与私网地址在分类地址实际上有分公有地址和私有地址平时我们办公室家里学校用的地址一般都是私有地址因为这些地址允许组织内部的人员自己管理自己分配而且可以重复因此你学校的某个私有地址和我学校的可以是一样的就像每个小区都有自己的楼编号和门牌号你小区家可以叫栋号我小区家也可以叫栋没有任何问题但一旦出了小区就需要带上中山路号公网地址是国家统一分配的不能两个小区都叫中山路所以公有地址是有个组织统一分配的假设你要开一个博客网站那么你就需要去申请购买一个公有这样全世界的人才能访问并且公有地址基本上要在整个互联网范围内保持唯一网络地址转换的地址是非常紧缺的在前面我们也提到可以通过无分类地址来减缓地址耗尽的速度但是互联网的用户增速是非常惊人的所以地址依然有被耗尽的危险于是提出了一个种网络地址转换的方法再次缓解了地址耗尽的问题简单的来说就是在同个公司家庭教室内的主机对外部通信时把私有地址转换成公有地址那不是个私有地址你就要个公有地址这怎么就缓解了地址耗尽的问题这不瞎扯吗确实是普通的转换没什么意义由于绝大多数的网络应用都是使用传输层协议或来传输数据的因此可以把地址端口号一起进行转换这样就用一个全球地址就可以了这种转换技术就叫网络地址与端口转换很抽象来看下面的图解就能瞬间明白了图中有两个客户端和同时与服务器进行通信并且这两个客户端的本地端口都是此时两个私有地址都转换地址为公有地址但是以不同的端口号作为区分于是生成一个路由器的转换表就可以正确地转换地址跟端口的组合令客户端能同时与服务器之间进行通信这种转换表在路由器上自动生成例如在的情况下建立连接首次握手时的包一经发出就会生成这个表而后又随着收到关闭连接时发出包的确认应答从表中被删除工作组工作组简介工作组是最常见最简单最普通的资源管理模式就是将不同的电脑按功能分别列入不同的组中以方便管理默认情况下所有计算机都处在名为的工作组中工作组资源管理模式适合于网络中计算机不多对管理要求不严格的情况它的建立步骤简单使用起来也很好上手大部分中小公司都采取工作组的方式对资源进行权限分配和目录共享相同组中的不同用户通过对方主机的用户名和密码可以查看对方共享的文件夹默认共享的是目录不同组的不同用户通过对方主机的用户名和密码也可以查看对方共享的文件夹所以工作组并不存在真正的集中管理作用工作组里的所有计算机都是对等的也就是没有服务器和客户机之分的工作组的加入和退出工作组的加入右击桌面上的计算机在弹出的菜单出选择属性点击更改设置更改在计算机名一栏中键入你想好的名称在工作组一栏中键入你想加入的工作组名称如果你输入的工作组名称网络中没有那么相当于新建了一个工作组当然暂时只有你的电脑在组内单击确定按钮后提示需要重新启动重新启动之后再进入网络就可以看到你所加入的工作组成员了工作组的退出只要将工作组名称改动即可不过在网上别人照样可以访问你的共享资源你也可以随便加入同一网络上的任何其它工作组工作组就像一个可以自由进入和退出的社团方便同一组的计算机互相访问工作组的访问文件夹网络就可以查看到我们工作组中的其他计算机了当你要访问某台计算机时点击它然后输入该主机的用户名和密码即可看到该主机共享的文件夹工作组的优点在一个网络内可能有上百台电脑如果这些电脑不进行分组都列在网上邻居中电脑无规则的排列为我们访问资源带来不方便为了解决这一问题操作系统之后就引用了工作组这个概念将不同的电脑按功能分别列入不同的组中如软件部的电脑都列入软件部工作组中网络部的电脑都列入网络部工作组中你要访问某个部门的资源就在网上邻居里找到那个部门的工作组名双击就可以看到那个部门的电脑了计算机通过工作组进行分类使得我们访问资源更加具有层次化工作组情况下资源可以相当随机和灵活的分布更方便资源共享管理员只需要实施相当低级的维护工作组的缺点缺乏集中管理与控制的机制没有集中的统一帐户管理没有对资源实施更加高效率的集中管理没有实施工作站的有效配置和安全性严密控制只适合小规模用户的使用基于以上缺点当计算机数量比较多大型企业中网络规模大需要统一的管理和集中的身份验证并且能够给用户提供方便的搜索和使用网络资源的方式工作组的组织形式就不合适了于是域就出现了域环境域简介域域是一个有安全边界的计算机集合安全边界意思是在两个域中一个域中的用户无法访问另一个域中的资源域内资源由一台域控制器集中管理用户名和密码是放在域控制器去验证的将网络中多台计算机逻辑上组织到一起进行集中管理这种区别于工作组的逻辑环境叫做域域是组织与存储资源的核心管理单元在域中至少有一台域控制器域控制器中保存着整个域的用户帐号和安全数据库可以简单的把域理解成升级版的工作组相比工作组而言它有一个更加严格的安全管理控制机制如果你想访问域内的资源就必须拥有一个合法的身份登陆到该域中而你对该域内的资源拥有什么样的权限还需要取决于你在该域中的用户身份域在不同系统与软件中含义有所不同域既是网络操作系统的逻辑组织单元也是的逻辑组织单元在网络操作系统中域是安全边界域网络的功能和特点权限集中管理域环境中所有的网络资源包括用户均是在域控制器上维护的便于集中管理所有用户只要登入到域均能在域内进行身份验证管理人员可以较好的管理计算机资源管理网络的成本大大降低同时在域环境中也可以防止企业员工在域成员主机上违规安装软件增强客户端安全性减少客户端故障降低维护成本便捷的资源访问能够很容易地定位到域中的资源用户依次登录就可以访问整个网络资源集中地身份验证也可由管理员指派登陆脚本映射用户登录后就可以像使用本地盘符一样使用网络上的资源且不需要再次输入密码可扩展性既可以适用于几十台计算机的小规模网络也可以用于跨国公司保密性加强有利于企业的一些保密资料的管理可以单独对资源进行权限控制允许或拒绝特定的域账户对资源的请求域成员计算机在登录的时候可以选择登录到域中或此计算机登陆到域中的时候身份验证是采用协议在域控制器上进行的登陆到此计算机则是通过来进行验证的默认情况下域用户可以登录到域中所有的工作站不包括域控制器管理员也可以指定具体的计算机域用户信息保存在活动目录中基于以上原因很多企业的内网均会采用域环境所以作为一名合格的渗透测试人员域渗透的常规思路和技巧要熟练掌握工作组和域的区别工作组是对等网络域是架构集中式管理域控域控在域架构中域控是用来管理所有客户端的服务器它负责每一台联入的电脑和用户的验证工作域内电脑如果想互相访问首先都得经过它的审核域控是域架构的核心每个域控制器上都包含了活动目录数据库一个域中可能应该要有至少两个域控一个作为一个是备份如果没有第二个备份那么一旦瘫痪了则域内的其他用户就不能登陆该域了因为活动目录的数据库包括用户的帐号信息存储在中的而有一台备份域控制器则至少该域还能正常使用期间把瘫痪的恢复了就行了当域中的一台计算机安装了后它就成了域控了活动目录域和活动目录的区别要实现域环境其实就是要安装一台计算机安装了之后就变成了简介活动目录是域环境中提供目录服务的组件在活动目录中所有的网络对象信息以一种结构化的数据存储方式来保存使得管理员和用户能够轻松地查找和使用这些信息活动目录以这种结构化的数据存储方式作为基础对目录信息进行合乎逻辑的分层组织活动目录存储着有关网络对象如用户组计算机共享资源打印机和联系人等的信息目录服务是帮助用户快速准确从目录中查找到他所需要的信息的服务安装有活动目录的服务器就是域控如果将企业的内网看成是一本字典那么内网里的资源就是字典的内容活动目录就相当于字典的索引即活动目录存储的是网络中所有资源的快捷方式用户通过寻找快捷方式而定位资源在活动目录中记录的信息被分为两大部分一部分保存在活动目录数据库文件中另一部分保存在被复制的文件系统上主要功能帐号集中管理所有帐号均存在服务器上方便对帐号的重命名重置密码软件集中管理统一推送软件统一安装网络打印机等利用软件发布策略分发软件可以让用户自由选择安装软件环境集中管理利用可以统一客户端桌面等设置增强安全性统一部署杀毒软件和扫毒任务集中化管理用户的计算机权限统一制订用户密码策略等可监控网络资料统一管理更可靠更少的宕机时间如利用控制用户访问权限利用群集负载均衡等技术对文件服务器进行容灾设定更可靠宕机时间更少活动目录为统一管理的基础平台其它等服务都依赖于这个基础平台域用户帐户以域数据库的形式保存在活动目录中是活动目录的数据库文件该文件记录的信息有以下三张表表这个表中包含了所有可在活动目录创建的对象信息以及他们之间的相互关系包括各种类型对象的可选及不可选的各种属性这个表是活动目录数据库中最小的一个表但是也是最基础的一个表表表包含所有属性的关联包括活动目录中所有对象的属性的值一个用户对象的所有属性的类型包括每个属性的值及用户所属于的组等信息都属于这个表这个表要大于表但与表相比要小表活动目录中用户组应用程序特殊数据和其他的数据全部保存在表中这是活动目录中存储信息最多的一个表大量的活动目录的资料实际上还是存储在这个表中逻辑结构在活动目录中管理员可以完全忽略被管理对象的具体地理位置而将这些对象按照一定的方式放置在不同的容器中由于这种组织对象的做法不考虑被管理对象的具体地理位置这种组织框架称为逻辑结构活动目录的逻辑结构包含组织单元域域树域森林域树内的所有域共享一个活动目录这个活动目录内的数据分散地存储在各个域内且每一个域只存储该域内的数据因此非常适合进行统一管理域服务容器容器是默认创建的第一个容器主要用于保存域中本地安全组容器容器是默认创建的第个容器用于存放域内所有成员计算机的计算机账号容器是一个特殊的容器主要用于保存当前域控制器下创建的所有子域和辅助域容器容器主要用于保存安装时系统自动创建的用户和登录到当前域控制器的所有用户账户域名服务器实现域名到地址的转换由于域中计算机使用来定位服务器和其他计算机的所以域的名字就是域的名字域控服务器要求服务器按名称查找计算机成员服务器和网络服务域名解析服务器通过其记录将域名解析成地址定位活动目录服务客户机通过服务器上的服务记录定位提供某一个服务的计算机一般情况下我们在内网渗透时就通过寻找服务器来定位域控制器因为通常服务器和域控制器会处在同一台机器上服务记录是服务器的数据库中支持的一种资源记录的类型它记录了哪台计算机提供了哪个服务这么一个简单的信息服务记录一般是为活动目录设置的应用可以独立于活动目录但是活动目录必须有的帮助才能工作为了活动目录能够正常的工作服务器必须支持服务定位资源记录资源记录把服务名字映射为提供服务的服务器名字域主机和域控制器使用资源记录决定域控制器的地址和提供服务的服务器地址域信任关系域之间的信任关系相当于是不同域之间沟通的桥梁域信任分为单向信任和双向信任单向信任只能是受信任域访问信任域而信任域不能访问受信任域双向信任是两个域可以互相访问父子信任父域与子域之间自动建立起了双向信任关系并且信任关系可以传递树信任同一个林中林根域与其他树根域自动建立双向信任关系信任关系可传递快捷方式信任为了加速认证流程而产生的信任关系需要管理员手工建立信任关系可向下传递林信任在不更改结构的情况下让不同林之间可以相互访问资源信任关系可向下传递外部信任跨林快捷方式信任类似于同林内的快捷方式信任单向信任关系不可传递领域信任为了让跟非系统的建立关系而存在的信任域结构分类单域即只有一个域的网络环境一般需要两台一台另一台备用容灾在一般的具有固定地理位置的小公司里建立一个域就可以满足所需父子域类比公司总部和公司分部的关系总部的域称为父域各分部的域称为该域的子域父域与子域之间默认建立起了双向信任关系使用父子域的好处减小了域之间信息交互的压力域内信息交互不会压缩域间信息交互可压缩不同的子域可以指定特定的安全策略父子域中域名使用一个表示一个层次类似于域名表示方式子域只能使用父域的名字作为域名后缀域树域树指若干个域通过建立信任关系组成的集合一个域管理员只能管理本域的内部不能访问或者管理其他的域二个域之间相互访问则需要建立信任关系通过信任关系可以将父子域连接成树状结构信任关系是连接在域与域之间的桥梁父域与子域之间自动建立起了双向信任关系域树内的父域与子域之间不但可以按需要相互进行管理还可以跨网分配文件和打印机等设备资源使不同的域之间实现网络资源的共享与管理以及相互通信和数据传输同一个域树中父域和子域会自动创建双向信任关系并且信任关系可传递所以也就是如下与和自动建立了双向信任关系与和自动建立了双向信任关系与和自动建立了双向信任关系由于信任关系可以传递所以和和与自动建立了双向信任关系以及和与都自动建立了双向信任关系但是和之间并没有建立起信任关系所以也就是和之间不能进行数据共享等操作他们之间要想进行数据共享等操作需要手动为他们之间建立信任关系建立域树的好处如果把不同地理位置的分公司放在同一个域内那么他们之间信息交互包括同步复制等所花费的时间会比较长而且占用的带宽也比较大因为在同一个域内信息交互的条目是很多的而且不压缩而在域和域之间信息交互的条目相对较少而且压缩还有一个好处就是子公司可以通过自己的域来管理自己的资源还有一种情况就是出于安全策略的考虑因为每个域都有自己独有的安全策略比如一个公司的财务部门希望能使用特定的安全策略包括帐号密码策略等那么可以将财务部门做成一个子域来单独管理在一个域树中父域可以包含很多子域子域是相对父域来说的指域名中的每一个段子域只能使用父域作为域名的后缀也就是说在一个域树中域的名字是连续的域林由一个或多个没有形成连续名称空间的域树组成若干个域树通过建立信任关系组成的集合林中每个域树都有唯一的名称空间之间不连续可以通过域树之间建立的信任关系来管理和使用整个域林中的资源从而又保持了原有域自身原有的特性同一个林中林根域与其他树根域自动建立双向信任关系信任关系可传递域的原理其实可以把域和工作组联系起来理解在工作组上你一切的设置比如在本机上进行各种策略用户登录都是登录在本机的密码是放在本机的数据库来验证的而如果你的计算机加入域的话各种策略是域控制器统一设定用户名和密码也是放到域控制器去验证也就是说你的账号密码域用户可以在同一个域的任何一台计算机登录如果说工作组是免费的旅店那么域就是星级的宾馆工作组可以随便出出进进而域则需要严格控制域的真正含义指的是服务器控制网络上的计算机能否加入计算机组合一提到组合势必需要严格的控制所以实行严格的管理对网络安全是非常必要的在对等网模式下任何一台电脑只要接入网络其他机器就都可以访问共享资源如共享文件夹等尽管对等网络上的共享文件可以加访问密码但是非常容易被破解不过在域模式下至少有一台服务器负责每一台联入网络的电脑和用户的验证工作相当于一个单位的门卫一样称为域控制器简写为域控制器中包含了这个域内的账户密码域内的计算机等信息构成的数据库当电脑联入网络时域控制器首先要鉴别这台电脑是否属于这个域使用的登录账号是否存在密码是否正确如果以上信息有一样不正确那么域控制器就会拒绝这个用户从这台电脑登录不能登录用户就不能访问服务器上有权限保护的资源他只能以对等网用户的方式访问共享出来的资源这样就在一定程度上保护了网络上的资源要把一台电脑加入域仅仅使它和服务器在网上邻居中能够相互看到是远远不够的必须要由网络管理员进行相应的设置把这台电脑加入到域中这样才能实现文件的共享集中统一便于管理在域控上即使以域管理员的身份登录也不能查看域成员的密码可以给域成员重置密码但是不能查看到域成员的密码安全域的划分内网安全级别最高分为核心区存储企业最重要的数据只有很少的主机能够访问和办公区员工日常工作区一般能够访问部分主机可以访问核心区边界网络隔离区安全级别中等作为内网中安全系统和非安全系统之间的缓冲区用于对外提供服务一般可以放置一些必须公开的服务器设施外网安全级别最低拥有的网络需要制定一些访问控制策略内网可以访问外网内网可以访问外网不能访问内网外网可以访问不能访问内网不能访问外网域中计算机的分类域控制器成员服务器客户机独立服务器域控制器用于管理所有的网络访问存储有域内所有的账户和策略信息允许网络中拥有多台域控制器容灾成员服务器安装了服务器操作系统并加入了域但没有安装活动目录的计算机主要任务是提供网络资源客户机安装了其他操作系统的计算机利用这些计算机和域中的账户就可以登录到域独立服务器和域无关既不加入域也没有活动目录域内权限域本地组多域用户访问单域资源访问同一个域主要用于授予本域内资源的访问权限可以从任何域中添加用户账号通用组和全局组域本地组无法嵌套在其他组中全局组单域用户访问多域资源必须是同一个域中的用户只能在创建该全局组的域中添加用户和全局组但可以在域森林中的任何域内指派权限也可以嵌套在其他组中通用组多域用户访问多域资源成员信息不保存在域控制器中而是保存在全局编录中任何变化都会导致全林复制策略用户账户全局组域本地组许可资源权限先将用户账号添加至全局组中再将全局组添加至域本地组中然后为域本地组分配资源权限域内权限解读域本地组来自全林作用于本域全局组来自本域作用于全林通用组来自全林作用于全林本地域组的权限管理员组最重要的权限远程登录组打印机操作员组帐号操作员组服务器操作员组备份操作员组全局组通用组的权限域管理员组最最最重要的权限一般来说域渗透是看重这个企业系统管理员组最重要的权限其次是去看重这个权限架构管理员组最重要的权限域用户组内网域渗透以获得域控制器的权限为目标一旦域控制器沦陷整个内网就尽在掌握中域渗透思路通过域成员主机定位出域控制器及域管理员账号利用域成员主机作为跳板扩大渗透范围利用域管理员可以登陆域中任何成员主机的特性定位出域管理员登陆过的主机设法从域成员主机内存中出域管理员密码进而拿下域控制器渗透整个内网机器位置判断分析机器处于网络拓扑中的某个区域是在区办公网还是核心区核心等多个位置当然这里的区域并不是绝对的只是大概的一个环境不同的地方网络环境不一样区域的界限也不一定明显区多数情况下在外围中我们拿到权限多数是在区不属于正式的内网如果是布置好的话区会处于一种内网能访问而访问不了内网的一种状态例如区的服务器访问不了管理员机器所处的内网机器办公区顾名思义是办公人员所处的网络例如一般办公人员服务器管理员等等能够渗透进办公网将对后续的渗透起到很大的帮助一般情况刚开始是很少会直接到达办公网段的除非是进行钓鱼种马啥的核心区例如域控核心生产机器等等这些都在后续的渗透才会慢慢接触到机器角色判断假如是服务器看看自己是否是普通服务器是开发测试服务器公共服务器文件服务器还是代理服务器服务器存储服务器等等具体的判断要通过对机器内的主机名文件网络连接等多种情况进行综合判断例如通过主机名是最好判断的开发服务器就是服务器可能是或者存储服务器可能是文件服务器可能是等等例如通过网络连接进行判断代理服务器可能就会有很多机器来连代理端口更新服务器例如可能开放了更新端口服务器开放了端口等等当然不能一概而论必须进行综合判断连通性判断指机器能否外面进的来能否出的去主要有两种一种是端口一种是协议我们着重于是否出的去协议的判断主要是看能够通过什么协议出去主要有等协议常见判断手法如下协议协议协议协议端口判断外网做监听内网机器测试常见端口或直接使用端口扫描器进行扫描常见能出去的端口有等代理服务器还有一种是机器不能直接出来的需要进行代理设置这种多数是为了办公网段得办公人员进行上网用的常用的判断手法与情况如下查看网络连接看是否有连接其他机器的不绝对等端口尝试是否有类似于的机器直接代理情况通过查询注册表得到通过文件自动代理情况从文件中查看其代理服务器及端口然后通过来确定不通不走代理无法访问到外网通通过代理能够访问到外网',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-26 17:26:34',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">嘻哈磕碜のBlogs</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="wechat" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="alipay" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ChatGpt/" style="font-size: 1.05rem;">ChatGpt<sup>2</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>1</sup></a><a href="/tags/MISC/" style="font-size: 1.05rem;">MISC<sup>2</sup></a><a href="/tags/MSF/" style="font-size: 1.05rem;">MSF<sup>1</sup></a><a href="/tags/Web%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">Web安全<sup>9</sup></a><a href="/tags/binwalk/" style="font-size: 1.05rem;">binwalk<sup>1</sup></a><a href="/tags/docker/" style="font-size: 1.05rem;">docker<sup>3</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>1</sup></a><a href="/tags/oracle/" style="font-size: 1.05rem;">oracle<sup>1</sup></a><a href="/tags/owasp/" style="font-size: 1.05rem;">owasp<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/redis/" style="font-size: 1.05rem;">redis<sup>1</sup></a><a href="/tags/shiro/" style="font-size: 1.05rem;">shiro<sup>1</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>1</sup></a><a href="/tags/ssrf/" style="font-size: 1.05rem;">ssrf<sup>1</sup></a><a href="/tags/xss/" style="font-size: 1.05rem;">xss<sup>2</sup></a><a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 1.05rem;">容器<sup>1</sup></a><a href="/tags/%E6%8A%A4%E7%BD%91/" style="font-size: 1.05rem;">护网<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>2</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">测试工具<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">七月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">25</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">渗透测试内网环境分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-08-19T08:22:38.000Z" title="发表于 2023-08-19 16:22:38">2023-08-19</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-08-26T09:26:34.593Z" title="更新于 2023-08-26 17:26:34">2023-08-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">8.9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>26分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="渗透测试内网环境分析"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为东莞"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>东莞</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/default_cover.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">Tianli GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://hihopkc.github.io/posts/26b5.html"><header><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url">网络安全</a><h1 id="CrawlerTitle" itemprop="name headline">渗透测试内网环境分析</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">hihopkc</span><time itemprop="dateCreated datePublished" datetime="2023-08-19T08:22:38.000Z" title="发表于 2023-08-19 16:22:38">2023-08-19</time><time itemprop="dateCreated datePublished" datetime="2023-08-26T09:26:34.593Z" title="更新于 2023-08-26 17:26:34">2023-08-26</time></header><h1 id="什么是内网渗透"><a href="#什么是内网渗透" class="headerlink" title="什么是内网渗透"></a>什么是内网渗透</h1><p>在拿到webshell&#x2F;meterpreter&#x2F;beacon的时候，想办法获得系统信息拿到系统权限，进入到网络系统内部之 后收集内部网络的各种信息，获取内部网络有价值的人员、资产信息。</p>
<p><strong>内网渗透的第一步，内网信息收集</strong></p>
<h1 id="内网外网简介"><a href="#内网外网简介" class="headerlink" title="内网外网简介"></a>内网外网简介</h1><h2 id="内网外网概念"><a href="#内网外网概念" class="headerlink" title="内网外网概念"></a>内网外网概念</h2><p>内网</p>
<ul>
<li><p>内网又称局域网（Local Area Network，LAN），是指在某一区域内由多台计算机以及网络设备构成的网络，比如校园网、政府网等，一般方圆几公里。</p>
</li>
<li><p>我们常说的内网，从字面意思上来讲是区别于外网的，也就是说内网一般是用于局域网内部的计算机之间的互相通信，如果需要访问Internet，需要借助外网。</p>
</li>
</ul>
<p>外网</p>
<ul>
<li><p>外网也被称为广域网（WAN），是连接不同地区局域网或城域网计算机通信的远程网。</p>
</li>
<li><p>所覆盖的范围从几十公里到几千公里，它能连接多个地区、城市和国家，或横跨几个洲并能提供远距离通信，形成国际性的远程网络。</p>
</li>
<li><p>广域网并不等同于互联网。</p>
</li>
</ul>
<p>内网与外网区别</p>
<ol>
<li>内网和外网的覆盖范围不一样，内网通常是一个学校、一个医院的网络，外网通常指Internet网；</li>
<li>内网一般是用于局域网内部的计算机之间的互相通信，如果需要访问Internet，需要借助外网，一般可以使用NAT技术实现内网访问外网；</li>
<li>内网的IP地址一般使用私有地址，例如192.168.1.0&#x2F;24；外网需要使用公网地址</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308191654972.png" alt="image-20230819165404992"></p>
<h2 id="公网IP与私网IP地址"><a href="#公网IP与私网IP地址" class="headerlink" title="公网IP与私网IP地址"></a>公网IP与私网IP地址</h2><p>在 A、B、C 分类地址，实际上有分公有 IP 地址和 私有 IP 地址。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308191655931.png" alt="20200808193448365"></p>
<p>平时我们办公室、家里、学校用的 IP 地址，一般都是私有 IP 地址。因为这些地址允许组织内部的 IT 人员自己管理、自己分配，而且可以重复。因此，你学校的某个私有 IP 地址和我学校的可以是一样的。</p>
<p>就像每个小区都有自己的楼编号和门牌号，你小区家可以叫 1 栋 101 号，我小区家也可以叫 1 栋 101，没有任何问题。但一旦出了小区，就需要带上中山路666 号（公网 IP 地址），是国家统一分配的，不能两个小区都叫中山路 666。</p>
<p>所以，公有 IP 地址是有个组织统一分配的，假设你要开一个博客网站，那么你就需要去申请购买一个公有 IP，这样全世界的人才能访问。并且公有 IP 地址基本上要在整个互联网范围内保持唯一。</p>
<h2 id="NAT网络地址转换"><a href="#NAT网络地址转换" class="headerlink" title="NAT网络地址转换"></a>NAT网络地址转换</h2><p>IPv4 的地址是非常紧缺的，在前面我们也提到可以通过无分类地址来减缓 IPv4 地址耗尽的速度，但是互联网的用户增速是非常惊人的，所以 IPv4 地址依然有被耗尽的危险。</p>
<p>于是，提出了一个种网络地址转换 NAT 的方法，再次缓解了 IPv4 地址耗尽的问题。</p>
<p>简单的来说 NAT 就是在同个公司、家庭、教室内的主机对外部通信时，把私有 IP 地址转换成公有 IP 地址。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308191657731.webp" alt="640-163825283931373"></p>
<blockquote>
<p>那不是 N 个 私有 IP 地址，你就要 N 个公有 IP 地址？<br>这怎么就缓解了 IPv4 地址耗尽的问题？<br>这不瞎扯吗？</p>
</blockquote>
<p>确实是，普通的 NAT 转换没什么意义。</p>
<p>由于绝大多数的网络应用都是使用传输层协议 TCP 或 UDP 来传输数据的。</p>
<p>因此，可以把 IP 地址 + 端口号一起进行转换。</p>
<p>这样，就用一个全球 IP 地址就可以了，这种转换技术就叫<strong>网络地址与端口转换 NAPT</strong></p>
<p>很抽象？来，看下面的图解就能瞬间明白了</p>
<ul>
<li>NAPT</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308191659238.webp" alt="640-163825311281575"></p>
<p>图中有两个客户端 192.168.1.10 和 192.168.1.11 同时与服务器 183.232.231.172 进行通信，并且这两个客户端的本地端口都是 1025。</p>
<p>此时，<strong>两个私有 IP 地址都转换 IP 地址为公有地址 120.229.175.121，但是以不同的端口号作为区分</strong>。</p>
<p>于是，生成一个 NAPT 路由器的转换表，就可以正确地转换地址跟端口的组合，令客户端 A、B 能同时与服务器之间进行通信。</p>
<p>这种转换表在 NAT 路由器上自动生成。例如，在 TCP 的情况下，建立 TCP 连接首次握手时的 SYN 包一经发出，就会生成这个表。而后又随着收到关闭连接时发出 FIN 包的确认应答从表中被删除。</p>
<h1 id="Windows工作组"><a href="#Windows工作组" class="headerlink" title="Windows工作组"></a>Windows工作组</h1><h2 id="工作组简介"><a href="#工作组简介" class="headerlink" title="工作组简介"></a>工作组简介</h2><blockquote>
<p>工作组(Work Group)：是最常见最简单最普通的资源管理模式，就是将不同的电脑按功能分别列入不同的组中，以方便管理。</p>
</blockquote>
<ol>
<li>默认情况下所有计算机都处在名为 WORKGROUP 的工作组中</li>
<li>工作组资源管理模式适合于网络中计算机不多，对管理要求不严格的情况。</li>
<li>它的建立步骤简单，使用起来也很好上手。大部分中小公司都采取工作组的方式对资源进行权限分配和目录共享。</li>
<li>相同组中的不同用户通过对方主机的用户名和密码可以查看对方共享的文件夹，默认共享的是 Users 目录。</li>
<li>不同组的不同用户通过对方主机的用户名和密码也可以查看对方共享的文件夹。</li>
<li>所以工作组并不存在真正的集中管理作用,工作组里的所有计算机都是对等的,也就是没有服务器和客户机之分的。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308211829489.png" alt="image-20230821182917543"></p>
<h2 id="工作组的加入和退出"><a href="#工作组的加入和退出" class="headerlink" title="工作组的加入和退出"></a>工作组的加入和退出</h2><ul>
<li>工作组的加入</li>
</ul>
<ol>
<li><p>右击桌面上的“计算机”，在弹出的菜单出选择“属性”，点击“更改设置”，“更改”，</p>
</li>
<li><p>在“计算机名”一栏中键入你想好的名称，在“工作组”一栏中键入你想加入的工作组名称。</p>
</li>
<li><p>如果你输入的工作组名称网络中没有，那么相当于新建了一个工作组，当然暂时只有你的电脑在组内。</p>
</li>
<li><p>单击“确定”按钮后，Windows提示需要重新启动，重新启动之后，再进入“网络”就可以看到你所加入的工作组成员了</p>
</li>
</ol>
<ul>
<li>工作组的退出</li>
</ul>
<ol>
<li><p>只要将工作组名称改动即可。不过在网上别人照样可以访问你的共享资源。你也可以随便加入同一网络上的任何其它工作组。</p>
</li>
<li><p>“工作组”就像一个可以自由进入和退出的“社团”，方便同一组的计算机互相访问。</p>
</li>
</ol>
<ul>
<li>工作组的访问</li>
</ul>
<p>文件夹–&gt;网络，就可以查看到我们工作组中的其他计算机了，当你要访问某台计算机时，点击它，然后输入该主机的用户名和密码即可看到该主机共享的文件<br>夹。</p>
<ul>
<li>工作组的优点</li>
</ul>
<p>在一个网络内，可能有上百台电脑，如果这些电脑不进行分组，都列在“网上邻居”中，电脑无规则的排列为我们访问资源带来不方便。为了解决这一问题，Windows98操作系统之后就引用了“工作组”这个概念，将不同的电脑按功能分别列入不同的组中，如软件部的电脑都列入“软件部”工作组中，网络部的电脑都列入“网络部”工作组中。你要访问某个部门的资源，就在“网上邻居”里找到那个部门的工作组名，双击就可以看到那个部门的电脑了。计算机通过工作组进行分类，使得我们访问资源更加具有层次化。工作组情况下资源可以相当随机和灵活的分布，更方便资源共享，管理员只需要实施相当低级的维护。</p>
<ul>
<li>工作组的缺点</li>
</ul>
<ol>
<li><p>缺乏集中管理与控制的机制</p>
</li>
<li><p>没有集中的统一帐户管理</p>
</li>
<li><p>没有对资源实施更加高效率的集中管理</p>
</li>
<li><p>没有实施工作站的有效配置和安全性严密控制</p>
</li>
<li><p>只适合小规模用户的使用</p>
</li>
</ol>
<p>基于以上缺点，当计算机数量比较多，大型企业中网络规模大，需要统一的管理和集中的身份验证，并且能够给用户提供方便的搜索和使用网络资源的方式，工作组的组织形式就不合适了，于是域就出现了</p>
<h1 id="Windows域环境"><a href="#Windows域环境" class="headerlink" title="Windows域环境"></a>Windows域环境</h1><h2 id="域简介"><a href="#域简介" class="headerlink" title="域简介"></a>域简介</h2><p>域（domain）：域是一个有安全边界的计算机集合（ 安全边界，意思是在两个域中，一个域中的用户无法访问另一个域中的资源）；域内资源由一台域控制器（Domain Controller，DC）<strong>集中管理</strong>，用户名和密码是放在域控制器去验证的。</p>
<p>将网络中多台计算机逻辑上组织到一起，进行集中管理，这种区别于工作组的逻辑环境叫做域，域是组织与存储资源的核心管理单元，<strong>在域中，至少有一台域控制器，域控制器中保存着整个域的用户帐号和安全数据库。</strong></p>
<p>可以简单的把域理解成升级版的“工作组”，相比工作组而言，它有一个更加严格的安全管理控制机制，如果你想访问域内的资源，就必须拥有一个合法的身份登陆到该域中，而你对该域内的资源拥有什么样的权限，还需要取决于你在该域中的用户身份。</p>
<p>域在不同系统与软件中含义有所不同：域既是Windows网络操作系统的逻辑组织单元，也是Internet的逻辑组织单元，在Windows网络操作系统中，域是安全边界。</p>
<h2 id="域网络的功能和特点"><a href="#域网络的功能和特点" class="headerlink" title="域网络的功能和特点"></a>域网络的功能和特点</h2><ol>
<li>权限集中管理</li>
</ol>
<p>域环境中，所有的网络资源，包括用户均是在域控制器上维护的，便于集中管理，所有用户只要登入到域，均能在域内进行身份验证，管理人员可以较好的管理计算机资源，管理网络的成本大大降低；同时在域环境中也可以防止企业员工在域成员主机上违规安装软件，增强客户端安全性，减少客户端故障，降低维护成本。</p>
<ol start="2">
<li>便捷的资源访问</li>
</ol>
<p>能够很容易地定位到域中的资源。用户依次登录就可以访问整个网络资源，集中地身份验证。也可由管理员指派登陆脚本映射，用户登录后就可以像使用本地盘符一样，使用网络上的资源，且不需要再次输入密码。</p>
<ol start="3">
<li>可扩展性</li>
</ol>
<p>既可以适用于几十台计算机的小规模网络，也可以用于跨国公司</p>
<ol start="4">
<li>保密性加强</li>
</ol>
<p>有利于企业的一些保密资料的管理，可以单独对资源进行权限控制，允许或拒绝特定的域账户对资源的请求。</p>
<p>域成员计算机在登录的时候可以选择登录到域中或此计算机，登陆到域中的时候，身份验证是采用Kerberos协议在域控制器上进行的，登陆到此计算机则是通过SAM来进行NTLM验证的。</p>
<p>默认情况下，<strong>域用户可以登录到域中所有的工作站</strong>，不包括域控制器，管理员也可以指定具体的计算机，域用户信息保存在活动目录中</p>
<p>基于以上原因，很多企业的内网均会采用域环境，所以作为一名合格的渗透测试人员，域渗透的常规思路和技巧要熟练掌握。</p>
<h2 id="工作组和域的区别"><a href="#工作组和域的区别" class="headerlink" title="工作组和域的区别"></a>工作组和域的区别</h2><p>工作组是对等网络，域是B&#x2F;S架构，集中式管理</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308211934448.png" alt="image-20230821193406383"></p>
<h2 id="域控DC"><a href="#域控DC" class="headerlink" title="域控DC"></a>域控DC</h2><p>域控DC (Domain Control)，在域架构中域控是用来管理所有客户端的服务器，它负责每一台联入的电脑和用户的验证工作，域内电脑如果想互相访问首先都得经过它的审核。</p>
<p>域控是域架构的核心，每个域控制器上都包含了AD活动目录数据库。</p>
<p>一个域中可能应该要有至少两个域控。一个作为DC，一个是备份DC。如果没有第二个备份DC，那么一旦DC瘫痪了，则域内的其他用户就不能登陆该域了，因为活动目录的数据库（包括用户的帐号信息）存储在DC中的。而有一台备份域控制器（BDC），则至少该域还能正常使用，期间把瘫痪的DC恢复了就行了。</p>
<p>当域中的一台计算机安装了AD后，它就成了域控DC了。</p>
<h2 id="活动目录"><a href="#活动目录" class="headerlink" title="活动目录"></a>活动目录</h2><p>域和活动目录的区别：要实现域环境，其实就是要安装AD。一台计算机安装了AD之后就变成了DC。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>活动目录：（Active Directory，AD）是域环境中提供目录服务的组件。在活动目录中，所有的网络对象信息以一种结构化的数据存储方式来保存，使得管理员和用户能够轻松地查找和使用这些信息。活动目录以这种结构化的数据存储方式作为基础，对目录信息进行合乎逻辑的分层组织。活动目录存储着有关网络对象（如用户、组、计算机、共享资源、打印机和联系人等）的信息。目录服务是帮助用户快速准确从目录中查找到他所需要的信息的服务。安装有AD活动目录的服务器就是域控DC。</p>
<p>如果将企业的内网看成是一本字典，那么内网里的资源就是字典的内容， 活动目录就相当于字典的索引。即活动目录存储的是网络中所有资源的快捷方式，用户通过寻找快捷方式而定位资源。</p>
<p>在活动目录中记录的信息，被分为两大部分，一部分保存在活动目录数据库文件 NTDS.dit 中，另一部分保存在被复制的文件系统上。</p>
<h3 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h3><ul>
<li>帐号集中管理：所有帐号均存在服务器上，方便对帐号的重命名&#x2F;重置密码。</li>
<li>软件集中管理：统一推送软件，统一安装网络打印机等。利用软件发布策略分发软件,可以让用户自由选择安装软件。</li>
<li>环境集中管理：利用AD可以统一客户端桌面，IE，TCP&#x2F;IP等设置。</li>
<li>增强安全性：统一部署杀毒软件和扫毒任务，集中化管理用户的计算机权限、统一制订用户密码策略等，可监控网络，资料统一管理。</li>
<li>更可靠：更少的宕机时间。如：利用AD控制用户访问权限，利用群集、负载均衡等技术对文件服务器进行容灾设定，更可靠，宕机时间更少。</li>
<li>活动目录为Microsoft统一管理的基础平台，其它 ISA、Exchange、SMS 等服务都依赖于这个基础平台。</li>
</ul>
<h3 id="NTDS-dit"><a href="#NTDS-dit" class="headerlink" title="NTDS.dit"></a>NTDS.dit</h3><p>域用户帐户以域数据库的形式保存在活动目录中，NTDS.dit是活动目录的数据库文件，该文件记录的信息有以下三张表：</p>
<p>Schema 表 ：这个表中包含了所有可在活动目录创建的对象信息以及他们之间的相互关系。包括各种类型对象的可选及不可选的各种属性。这个表是活动目录数据库中最小的一个表，但是也是最基础的一个表。</p>
<p>Link 表 ：Link表包含所有属性的关联，包括活动目录中所有对象的属性的值。一个用户对象的所有属性的类型，包括每个属性的值及用户所属于的组等信息都属于这个表。这个表要大于Schema 表，但与Data 表相比要小。</p>
<p>Data 表：活动目录中用户，组，应用程序特殊数据和其他的数据全部保存在Data表中。这是活动目录中存储信息最多的一个表，大量的活动目录的资料实际上还是存储在这个表中。</p>
<h3 id="逻辑结构"><a href="#逻辑结构" class="headerlink" title="逻辑结构"></a>逻辑结构</h3><p>在活动目录中，管理员可以完全忽略被管理对象的具体地理位置，而将这些对象按照一定的方式放置在不同的容器中。由于这种组织对象的做法不考虑被管理对象的具体地理位置，这种组织框架称为 “ 逻辑结构 ”。</p>
<p>活动目录的逻辑结构包含组织单元(OU)、域(domain)、域树(tree)、域森林(forest)。域树内的所有域共享一个活动目录，这个活动目录内的数据分散地存储在各个域内，且每一个域只存储该域内的数据，因此非常适合进行统一管理。</p>
<h3 id="AD域服务"><a href="#AD域服务" class="headerlink" title="AD域服务"></a>AD域服务</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308252022452.png" alt="image-20230825202221399"></p>
<ul>
<li>Builtin容器：Builtin容器是Active Driectory默认创建的第一个容器，主要用于保存域中本地安全组。</li>
<li>Computers容器：Computers容器是Active Driectory默认创建的第2个容器，用于存放Windows Server域内所有成员计算机的计算机账号。</li>
<li>Domain Controllers容器：Domain Controllers是一个特殊的容器，主要用于保存当前域控制器下创建的所有子域和辅助域。</li>
<li>Users容器：Users容器主要用于保存安装Active Driectory时系统自动创建的用户和登录到当前域控制器的所有用户账户。</li>
</ul>
<h2 id="DNS域名服务器"><a href="#DNS域名服务器" class="headerlink" title="DNS域名服务器"></a>DNS域名服务器</h2><p>实现域名到IP地址的转换。由于域中计算机使用DNS来定位DC、服务器和其他计算机的，所以域的名字就是DNS域的名字。</p>
<ul>
<li>域控服务器要求DNS服务器按名称查找计算机、成员服务器和网络服务。</li>
<li>域名解析：DNS服务器通过其A记录将域名解析成IP地址</li>
<li>定位活动目录服务：客户机通过DNS服务器上的 SRV 服务记录定位提供某一个服务的计算机</li>
</ul>
<p>一般情况下，我们在内网渗透时就通过寻找DNS服务器来定位域控制器，因为通常DNS服务器和域控制器会处在同一台机器上。</p>
<p>SRV服务记录是DNS服务器的数据库中支持的一种资源记录的类型，它记录了哪台计算机提供了哪个服务这么一个简单的信息。</p>
<p>SRV服务记录：一般是为活动目录AD设置的应用。DNS可以独立于活动目录，但是活动目录必须有DNS的帮助才能工作。为了活动目录能够正常的工作，DNS服务器必须支持服务定位（SRV）资源记录，资源记录把服务名字映射为提供服务的服务器名字。域主机和域控制器使用SRV资源记录决定域控制器的IP地址和提供服务的服务器IP地址。</p>
<h2 id="域信任关系"><a href="#域信任关系" class="headerlink" title="域信任关系"></a>域信任关系</h2><p>域之间的信任关系，相当于是不同域之间沟通的桥梁。域信任分为 单向信任 和 双向信任。</p>
<p>单向信任只能是受信任域访问信任域，而信任域不能访问受信任域。双向信任是两个域可以互相访问。</p>
<p>父子信任：父域与子域之间自动建立起了双向信任关系，并且信任关系可以传递。</p>
<p>树信任：同一个林中，林根域与其他树根域自动建立双向信任关系。信任关系可传递。</p>
<p>快捷方式信任：为了加速认证流程而产生的信任关系。需要管理员手工建立，信任关系可向下传递。</p>
<p>林信任：在不更改AD结构的情况下，让不同林之间可以相互访问资源。信任关系可向下传递。</p>
<p>外部信任&#x2F; 跨林快捷方式信任：类似于同林内的快捷方式信任. 单向, 信任关系不可传递：</p>
<p>领域信任：为了让AD跟非Windows系统的Kerberos建立关系而存在的信任。</p>
<h2 id="域结构分类"><a href="#域结构分类" class="headerlink" title="域结构分类"></a>域结构分类</h2><h3 id="单域"><a href="#单域" class="headerlink" title="单域"></a>单域</h3><p>即只有一个域的网络环境，一般需要两台DC，一台DC，另一台备用DC（容灾）<br>在一般的具有固定地理位置的小公司里，建立一个域就可以满足所需。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308221144780.png" alt="image-20230822114405696"></p>
<h3 id="父子域"><a href="#父子域" class="headerlink" title="父子域"></a>父子域</h3><p>类比公司总部和公司分部的关系，总部的域称为父域，各分部的域称为该域的子域。父域与子域之间默认建立起了双向信任关系。</p>
<ul>
<li>使用父子域的好处</li>
</ul>
<ol>
<li>减小了域之间信息交互的压力（域内信息交互不会压缩，域间信息交互可压缩）</li>
<li>不同的子域可以指定特定的安全策略</li>
</ol>
<p>父子域中域名使用一个.表示一个层次，类似于DNS域名表示方式，子域只能使用父域的名字作为域名后缀</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308221145251.png" alt="image-20230822114539216"></p>
<h3 id="域树"><a href="#域树" class="headerlink" title="域树"></a>域树</h3><p>域树指若干个域通过建立信任关系组成的集合。一个域管理员只能管理本域的内部，不能访问或者管理其他的域，二个域之间相互访问则需要建立<strong>信任关系</strong>(Trust Relation)，通过信任关系可以将父子域连接成树状结构</p>
<p>信任关系是连接在域与域之间的桥梁。父域与子域之间自动建立起了双向信任关系，域树内的父域与子域之间不但可以按需要相互进行管理，还可以跨网分配文件和打印机等设备资源，使不同的域之间实现网络资源的共享与管理，以及相互通信和数据传输。</p>
<p>同一个域树中，父域和子域会自动创建双向信任关系，并且信任关系可传递。</p>
<p>所以也就是如下：</p>
<ul>
<li>kc.lab 与 cn.kc.lab 和 us.kc.lab 自动建立了双向信任关系。</li>
<li>cn.kc.lab 与 a.cn.kc.lab 和 b.cn.kc.lab 自动建立了双向信任关系。</li>
<li>us.kc.lab 与 a.us.yi.lab 和 b.us.kc.lab 自动建立了双向信任关系。</li>
<li>由于信任关系可以传递，所以和a.cn.kc.lab 和 b.cn.kc.lab 与 kc.lab 自动建立了双向信任关系。以及 a.us.kc.lab 和 b.us.kc.lab 与 kc.lab 都自动建立了双向信任关系。</li>
<li>但是 cn.kc.lab 和 us.kc.lab 之间并没有建立起信任关系。所以也就是 cn.kc.lab 和 us.kc.lab 之间不能进行数据共享等操作。他们之间要想进行数据共享等操作，需要手动为他们之间建立信任关系</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308221152746.png" alt="image-20230822115230702"></p>
<ul>
<li>建立域树的好处</li>
</ul>
<p>如果把不同地理位置的分公司放在同一个域内，那么他们之间信息交互（包括同步，复制等）所花费的时间会比较长，而且占用的带宽也比较大。（因为在同一个域内，信息交互的条目是很多的，而且不压缩；而在域和域之间，信息交互的条目相对较少，而且压缩。）</p>
<p>还有一个好处，就是子公司可以通过自己的域来管理自己的资源。</p>
<p>还有一种情况，就是出于安全策略的考虑，因为每个域都有自己独有的安全策略。比如一个公司的财务部门希望能使用特定的安全策略（包括帐号密码策略等），那么可以将财务部门做成一个子域来单独管理</p>
<p>在一个域树中，父域可以包含很多子域，子域是相对父域来说的，指域名中的每一个段。子域只能使用父域作为域名的后缀，也就是说在一个域树中，域的名字是连续的。</p>
<h3 id="域林"><a href="#域林" class="headerlink" title="域林"></a>域林</h3><p>由一个或多个没有形成连续名称空间的域树组成，若干个域树通过建立信任关系组成的集合。林中每个域树都有唯一的名称空间，之间不连续。</p>
<p>可以通过域树之间建立的信任关系来管理和使用整个域林中的资源，从而又保持了原有域自身原有的特性。</p>
<p>同一个林中，林根域与其他树根域自动建立双向信任关系，信任关系可传递。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308221154244.png" alt="image-20230822115439194"></p>
<h2 id="域的原理"><a href="#域的原理" class="headerlink" title="域的原理"></a>域的原理</h2><p>其实可以把域和工作组联系起来理解，在工作组上你一切的设置比如在本机上进行各种策略，用户登录都是登录在本机的，密码是放在本机的数据库来验证的。而如果你的计算机加入域的话，各种策略是域控制器统一设定，用户名和密码也是放到域控制器去验证，也就是说你的账号密码(域用户)可以在同一个域的任何一台计算机登录。</p>
<p>如果说工作组是“免费的旅店”，那么域（Domain）就是“星级的宾馆”；工作组可以随便出出进进，而域则需要严格控制。“域”的真正含义指的是服务器控制网络上的计算机能否加入计算机组合。一提到组合，势必需要严格的控制。所以实行严格的管理对网络安全是非常必要的。在对等网模式下，任何一台电脑只要接入网络，其他机器就都可以访问共享资源，如共享文件夹等。尽管对等网络上的共享文件可以加访问密码，但是非常容易被破解。</p>
<p>不过在“域”模式下，至少有一台服务器负责每一台联入网络的电脑和用户的验证工作，相当于一个单位的门卫一样，称为域控制器（Domain Controller，简写为DC）。</p>
<p>域控制器中包含了这个域内的账户、密码、域内的计算机等信息构成的数据库(AD)。当电脑联入网络时，域控制器首先要鉴别这台电脑是否属于这个域，使用的登录账号是否存在、密码是否正确。如果以上信息有一样不正确，那么域控制器就会拒绝这个用户从这台电脑登录。不能登录，用户就不能访问服务器上有权限保护的资源，他只能以对等网用户的方式访问Windows共享出来的资源，这样就在一定程度上保护了网络上的资源。</p>
<p>要把一台电脑加入域，仅仅使它和服务器在网上邻居中能够相互“看”到是远远不够的，必须要由网络管理员进行相应的设置，把这台电脑加入到域中。这样才能实现文件的共享，集中统一，便于管理</p>
<p>在域控上，即使以域管理员的身份登录，也不能查看域成员的密码，可以给域成员重置密码，但是不能查看到域成员的密码。</p>
<h2 id="安全域的划分"><a href="#安全域的划分" class="headerlink" title="安全域的划分"></a>安全域的划分</h2><ul>
<li>内网（安全级别最高）：分为核心区（存储企业最重要的数据，只有很少的主机能够访问）和办公区（员工日常工作区，一般能够访问DMZ，部分主机可以访问核心区）</li>
<li>DMZ（Demilitarized Zone，边界网络，隔离区，安全级别中等）：作为内网中安全系统和非安全系统之间的缓冲区，用于对外提供服务，一般可以放置一些必须公开的服务器设施</li>
<li>外网（Internet，安全级别最低）</li>
</ul>
<p>拥有DMZ的网络需要制定一些访问控制策略：</p>
<ol>
<li>内网可以访问外网</li>
<li>内网可以访问DMZ</li>
<li>外网不能访问内网</li>
<li>外网可以访问DMZ</li>
<li>DMZ不能访问内网</li>
<li>DMZ不能访问外网</li>
</ol>
<h2 id="域中计算机的分类"><a href="#域中计算机的分类" class="headerlink" title="域中计算机的分类"></a>域中计算机的分类</h2><p>域控制器、成员服务器、客户机、独立服务器</p>
<p>域控制器：用于管理所有的网络访问，存储有域内所有的账户和策略信息。允许网络中拥有多台域控制器（容灾）</p>
<p>成员服务器：安装了服务器操作系统并加入了域，但没有安装活动目录的计算机，主要任务是提供网络资源</p>
<p>客户机：安装了其他操作系统的计算机，利用这些计算机和域中的账户就可以登录到域。</p>
<p>独立服务器：和域无关，既不加入域，也没有活动目录</p>
<h2 id="域内权限"><a href="#域内权限" class="headerlink" title="域内权限"></a>域内权限</h2><p>域本地组：</p>
<p>多域用户访问单域资源</p>
<p>（访问同一个域），主要用于授予本域内资源的访问权限，可以从任何域中添加用户账号、通用组和全局组。域本地组无法嵌套在其他组中</p>
<p>全局组：</p>
<p>单域用户访问多域资源</p>
<p>（必须是同一个域中的用户），只能在创建该全局组的域中添加用户和全局组，但可以在域森林中的任何域内指派权限，也可以嵌套在其他组中</p>
<p>通用组：多域用户访问多域资源，成员信息不保存在域控制器中，而是保存在全局编录（GC）中，任何变化都会导致全林复制</p>
<h2 id="A-G-DL-P策略"><a href="#A-G-DL-P策略" class="headerlink" title="A-G-DL-P策略"></a>A-G-DL-P策略</h2><p>A：用户账户<br>G：全局组<br>DL：域本地组<br>P：许可，资源权限</p>
<p>先将用户账号添加至全局组中，再将全局组添加至域本地组中，然后为域本地组分配资源权限。</p>
<h2 id="域内权限解读"><a href="#域内权限解读" class="headerlink" title="域内权限解读"></a>域内权限解读</h2><p>域本地组：来自全林作用于本域<br>全局组：来自本域作用于全林<br>通用组：来自全林作用于全林</p>
<ul>
<li>本地域组的权限</li>
</ul>
<p>Administrators（管理员组） ————最重要的权限<br>Remote Desktop Users（远程登录组）<br>Print Operators（打印机操作员组）<br>Account Operators（帐号操作员组）<br>Server Operaters（服务器操作员组）<br>Backup Operators（备份操作员组）</p>
<ul>
<li>全局组、通用组的权限</li>
</ul>
<p>Domain Admins（域管理员组）— 最最最重要的权限，一般来说域渗透是看重这个<br>Enterprise Admins（企业系统管理员组）— 最重要的权限，其次是去看重这个权限<br>Schema Admins（架构管理员组）— 最重要的权限<br>Domain Users（域用户组)</p>
<h2 id="内网域渗透"><a href="#内网域渗透" class="headerlink" title="内网域渗透"></a>内网域渗透</h2><p>以<strong>获得域控制器的权限</strong>为目标，一旦域控制器沦陷，整个内网就尽在掌握中。</p>
<h2 id="域渗透思路"><a href="#域渗透思路" class="headerlink" title="域渗透思路"></a>域渗透思路</h2><ul>
<li>通过域成员主机，定位出域控制器IP及域管理员账号</li>
<li>利用域成员主机作为跳板，扩大渗透范围</li>
<li>利用域管理员可以登陆域中任何成员主机的特性，定位出域管理员登陆过的主机IP</li>
<li>设法从域成员主机内存中dump出域管理员密码</li>
<li>进而拿下域控制器、渗透整个内网。</li>
</ul>
<h1 id="机器位置判断"><a href="#机器位置判断" class="headerlink" title="机器位置判断"></a>机器位置判断</h1><p>分析机器处于网络拓扑中的某个区域，是在DMZ区，办公网，还是核心区，核心DB等多个位置，当然这里的区域并不是绝对的，只是大概的一个环境，不同的地方网络环境不一样，区域的界限也不一定明显。</p>
<p>DMZ区：多数情况下在外围Web中我们拿到权限多数是在DMZ区，不属于正式的内网，如果是布置好的话，DMZ区会处于一种内网能访问DMZ，而DMZ访问不了内网的一种状态。例如DMZ区的服务器访问不了管理员机器所处的内网机器。</p>
<p>办公区：顾名思义是办公人员所处的网络，例如一般办公人员，服务器管理员等等，能够渗透进办公网将对后续的渗透起到很大的帮助。一般情况刚开始是很少会直接到达办公网段的，除非是进行钓鱼种马啥的。</p>
<p>核心区：例如域控，核心生产机器等等，这些都在后续的渗透才会慢慢接触到。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308261641675.jpg" alt="a4db6e1bff965bd9ed156b7dbc84c5a"></p>
<h1 id="机器角色判断"><a href="#机器角色判断" class="headerlink" title="机器角色判断"></a>机器角色判断</h1><p>假如是服务器，看看自己是否是普通Web服务器，是开发测试服务器，公共服务器，文件服务器，还是代理服务器，DNS服务器、存储服务器等等。</p>
<p>具体的判断要通过对机器内的主机名、文件、网络连接等多种情况进行综合判断。</p>
<p>例如通过主机名是最好判断的，开发服务器就是dev , Web服务器可能是web或者app，存储服务器可能是NAS，文件服务器可能是fileserver等等。</p>
<p>例如通过网络连接进行判断，代理服务器可能就会有很多机器来连代理端口，更新服务器（例如WSUS）可能开放了更新端口8530，DNS服务器开放了53端口等等，当然不能一概而论，必须进行综合判断。</p>
<h1 id="连通性判断"><a href="#连通性判断" class="headerlink" title="连通性判断"></a>连通性判断</h1><p>指机器能否外面进的来，能否出的去。</p>
<p>主要有两种，一种是端口，一种是协议。我们着重于是否出的去。</p>
<h2 id="协议的判断"><a href="#协议的判断" class="headerlink" title="协议的判断"></a>协议的判断</h2><p>主要是看能够通过什么协议出去，主要有tcp&#x2F;http&#x2F;dns&#x2F;icmp等协议。常见判断手法如下：</p>
<p>TCP协议：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vps：nc -lvvp 8888</span><br><span class="line">target：nc vps-ip 8888</span><br></pre></td></tr></table></figure>

<p>DNS协议：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vps：nc -u -lvp 53</span><br><span class="line">target：</span><br><span class="line">nslookup www.baidu.com vps-ip</span><br><span class="line">dig @vsp-ip www.baidu.com</span><br></pre></td></tr></table></figure>

<p>HTTP协议：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vps：nc -lvvp 80</span><br><span class="line">target：curl vps-ip 80</span><br></pre></td></tr></table></figure>

<p>ICMP协议：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vps：tcpdump icmp</span><br><span class="line">target：ping vps-ip</span><br></pre></td></tr></table></figure>

<h2 id="端口判断"><a href="#端口判断" class="headerlink" title="端口判断"></a>端口判断</h2><p>外网vps做监听，内网机器测试常见端口，或直接使用端口扫描器进行扫描。</p>
<p>常见能出去的端口有 80,8080,443,53,110,123 等。</p>
<h2 id="代理服务器"><a href="#代理服务器" class="headerlink" title="代理服务器"></a>代理服务器</h2><p>还有一种是机器不能直接出来的，需要进行代理设置，这种多数是为了办公网段得办公人员进行上网用的。</p>
<p>常用的判断手法与情况如下：</p>
<ul>
<li>查看网络连接看是否有连接其他机器的8080（不绝对）等端口，尝试ping –n 1 –a ip</li>
<li>是否有hostname类似于proxy的机器</li>
<li>IE直接代理情况</li>
</ul>
<p>通过查询注册表得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REG QUERY &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot; /v ProxyServer</span><br><span class="line"></span><br><span class="line">#通过pac文件自动代理情况</span><br><span class="line">REG QUERY &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot; /v AutoConfigURL</span><br></pre></td></tr></table></figure>

<p>从pac文件中查看其代理服务器IP及端口，然后通过curl来确定：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl www.baidu.com #不通，不走代理无法访问到外网</span><br><span class="line">curl -x proxy-ip:8080 www.baidu.com #通，通过代理能够访问到外网</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">hihopkc</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://hihopkc.github.io/posts/26b5.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://hihopkc.github.io/posts/26b5.html')">渗透测试内网环境分析</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://hihopkc.github.io/posts/26b5.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=渗透测试内网环境分析&amp;url=https://hihopkc.github.io/posts/26b5.html&amp;pic=/img/default_cover.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hihopkc.github.io" target="_blank">嘻哈磕碜のBlogs</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="/img/default_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2aa5.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux反弹Shell</div></div></a></div><div class="next-post pull-right"><a href="/posts/c2b3.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308271114157.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MoeCTF2023WP</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description">站在巨人的肩上</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">hihopkc</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/hihopkc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/56853573" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">1.</span> <span class="toc-text">什么是内网渗透</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">内网外网简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E5%A4%96%E7%BD%91%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.</span> <span class="toc-text">内网外网概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E7%BD%91IP%E4%B8%8E%E7%A7%81%E7%BD%91IP%E5%9C%B0%E5%9D%80"><span class="toc-number">2.2.</span> <span class="toc-text">公网IP与私网IP地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.3.</span> <span class="toc-text">NAT网络地址转换</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows%E5%B7%A5%E4%BD%9C%E7%BB%84"><span class="toc-number">3.</span> <span class="toc-text">Windows工作组</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E7%BB%84%E7%AE%80%E4%BB%8B"><span class="toc-number">3.1.</span> <span class="toc-text">工作组简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E7%BB%84%E7%9A%84%E5%8A%A0%E5%85%A5%E5%92%8C%E9%80%80%E5%87%BA"><span class="toc-number">3.2.</span> <span class="toc-text">工作组的加入和退出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows%E5%9F%9F%E7%8E%AF%E5%A2%83"><span class="toc-number">4.</span> <span class="toc-text">Windows域环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">域简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E7%BD%91%E7%BB%9C%E7%9A%84%E5%8A%9F%E8%83%BD%E5%92%8C%E7%89%B9%E7%82%B9"><span class="toc-number">4.2.</span> <span class="toc-text">域网络的功能和特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E7%BB%84%E5%92%8C%E5%9F%9F%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.3.</span> <span class="toc-text">工作组和域的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E6%8E%A7DC"><span class="toc-number">4.4.</span> <span class="toc-text">域控DC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95"><span class="toc-number">4.5.</span> <span class="toc-text">活动目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">4.5.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">4.5.2.</span> <span class="toc-text">主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NTDS-dit"><span class="toc-number">4.5.3.</span> <span class="toc-text">NTDS.dit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84"><span class="toc-number">4.5.4.</span> <span class="toc-text">逻辑结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AD%E5%9F%9F%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.5.5.</span> <span class="toc-text">AD域服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">4.6.</span> <span class="toc-text">DNS域名服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E4%BF%A1%E4%BB%BB%E5%85%B3%E7%B3%BB"><span class="toc-number">4.7.</span> <span class="toc-text">域信任关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E7%BB%93%E6%9E%84%E5%88%86%E7%B1%BB"><span class="toc-number">4.8.</span> <span class="toc-text">域结构分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%9F%9F"><span class="toc-number">4.8.1.</span> <span class="toc-text">单域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E5%9F%9F"><span class="toc-number">4.8.2.</span> <span class="toc-text">父子域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%A0%91"><span class="toc-number">4.8.3.</span> <span class="toc-text">域树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%9E%97"><span class="toc-number">4.8.4.</span> <span class="toc-text">域林</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">4.9.</span> <span class="toc-text">域的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E5%9F%9F%E7%9A%84%E5%88%92%E5%88%86"><span class="toc-number">4.10.</span> <span class="toc-text">安全域的划分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E4%B8%AD%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">4.11.</span> <span class="toc-text">域中计算机的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E6%9D%83%E9%99%90"><span class="toc-number">4.12.</span> <span class="toc-text">域内权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-G-DL-P%E7%AD%96%E7%95%A5"><span class="toc-number">4.13.</span> <span class="toc-text">A-G-DL-P策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E5%86%85%E6%9D%83%E9%99%90%E8%A7%A3%E8%AF%BB"><span class="toc-number">4.14.</span> <span class="toc-text">域内权限解读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E5%9F%9F%E6%B8%97%E9%80%8F"><span class="toc-number">4.15.</span> <span class="toc-text">内网域渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF"><span class="toc-number">4.16.</span> <span class="toc-text">域渗透思路</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%BA%E5%99%A8%E4%BD%8D%E7%BD%AE%E5%88%A4%E6%96%AD"><span class="toc-number">5.</span> <span class="toc-text">机器位置判断</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%BA%E5%99%A8%E8%A7%92%E8%89%B2%E5%88%A4%E6%96%AD"><span class="toc-number">6.</span> <span class="toc-text">机器角色判断</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9E%E9%80%9A%E6%80%A7%E5%88%A4%E6%96%AD"><span class="toc-number">7.</span> <span class="toc-text">连通性判断</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%A4%E6%96%AD"><span class="toc-number">7.1.</span> <span class="toc-text">协议的判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%88%A4%E6%96%AD"><span class="toc-number">7.2.</span> <span class="toc-text">端口判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">7.3.</span> <span class="toc-text">代理服务器</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/14d8.html" title="域环境密码凭证获取"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="域环境密码凭证获取"/></a><div class="content"><a class="title" href="/posts/14d8.html" title="域环境密码凭证获取">域环境密码凭证获取</a><time datetime="2023-09-05T13:42:50.000Z" title="发表于 2023-09-05 21:42:50">2023-09-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8784.html" title="2023年“羊城杯”网络安全大赛WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023年“羊城杯”网络安全大赛WP"/></a><div class="content"><a class="title" href="/posts/8784.html" title="2023年“羊城杯”网络安全大赛WP">2023年“羊城杯”网络安全大赛WP</a><time datetime="2023-09-04T13:31:26.000Z" title="发表于 2023-09-04 21:31:26">2023-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c8e.html" title="Windows密码凭证获取"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Windows密码凭证获取"/></a><div class="content"><a class="title" href="/posts/c8e.html" title="Windows密码凭证获取">Windows密码凭证获取</a><time datetime="2023-08-29T15:12:11.000Z" title="发表于 2023-08-29 23:12:11">2023-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d84f.html" title="第二届陇剑杯WP"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202308290021297.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="第二届陇剑杯WP"/></a><div class="content"><a class="title" href="/posts/d84f.html" title="第二届陇剑杯WP">第二届陇剑杯WP</a><time datetime="2023-08-28T16:20:43.000Z" title="发表于 2023-08-29 00:20:43">2023-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/78fc.html" title="渗透测试内网信息收集"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="渗透测试内网信息收集"/></a><div class="content"><a class="title" href="/posts/78fc.html" title="渗透测试内网信息收集">渗透测试内网信息收集</a><time datetime="2023-08-24T03:04:00.000Z" title="发表于 2023-08-24 11:04:00">2023-08-24</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:975025272@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hihopkc-blog.oss-cn-shenzhen.aliyuncs.com/img/202303232356277.png" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/hihopkc" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 By hihopkc </div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">60</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">14</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/ChatGpt/" style="font-size: 0.88rem;">ChatGpt<sup>2</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>1</sup></a><a href="/tags/MISC/" style="font-size: 0.88rem;">MISC<sup>2</sup></a><a href="/tags/MSF/" style="font-size: 0.88rem;">MSF<sup>1</sup></a><a href="/tags/Web%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">Web安全<sup>9</sup></a><a href="/tags/binwalk/" style="font-size: 0.88rem;">binwalk<sup>1</sup></a><a href="/tags/docker/" style="font-size: 0.88rem;">docker<sup>3</sup></a><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>1</sup></a><a href="/tags/oracle/" style="font-size: 0.88rem;">oracle<sup>1</sup></a><a href="/tags/owasp/" style="font-size: 0.88rem;">owasp<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>1</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>1</sup></a><a href="/tags/shiro/" style="font-size: 0.88rem;">shiro<sup>1</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>1</sup></a><a href="/tags/ssrf/" style="font-size: 0.88rem;">ssrf<sup>1</sup></a><a href="/tags/xss/" style="font-size: 0.88rem;">xss<sup>2</sup></a><a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 0.88rem;">容器<sup>1</sup></a><a href="/tags/%E6%8A%A4%E7%BD%91/" style="font-size: 0.88rem;">护网<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>2</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">测试工具<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.0.8/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("02/18/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `你好，欢迎你来到我的博客!`,
    `保持热爱，奔赴山海✨`,
    `
        
    ██╗  ██╗██╗██╗  ██╗ ██████╗ ██████╗ ██╗  ██╗ ██████╗
    ██║  ██║██║██║  ██║██╔═══██╗██╔══██╗██║ ██╔╝██╔════╝
    ███████║██║███████║██║   ██║██████╔╝█████╔╝ ██║     
    ██╔══██║██║██╔══██║██║   ██║██╔═══╝ ██╔═██╗ ██║     
    ██║  ██║██║██║  ██║╚██████╔╝██║     ██║  ██╗╚██████╗
    ╚═╝  ╚═╝╚═╝╚═╝  ╚═╝ ╚═════╝ ╚═╝     ╚═╝  ╚═╝ ╚═════╝
        
    `,
    "已上线",
    dnum,
    "天",
    "©2023 By hihopkc V1.6.5",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小丑】.`, `Photo captured: `, `🤣👉🏻🤡`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小丑.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 hihopkc 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://hihopkc.space/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.18/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://hihopkc.space/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://hihopkc.space/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.18/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script type="text/javascript" src="/js/fps.js"></script><div id="fps"></div><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>